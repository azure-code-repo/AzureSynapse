CREATE PROC [EDAA_ETL].[PROC_FCT_DLY_ITM_SKU_STR_DF_INV_QTY_AGG_LOAD] AS

  BEGIN
      --exec [EDAA_ETL].[PROC_FCT_DLY_ITM_SKU_STR_DF_INV_QTY_AGG_LOAD]
	  BEGIN TRY

		/*Datamart Auditing variables*/
		DECLARE @NEW_AUD_SKY bigint
		DECLARE @NBR_OF_RW_ISRT bigint
		DECLARE @NBR_OF_RW_UDT bigint
		DECLARE @EXEC_LYR varchar(255)
		DECLARE @EXEC_JOB varchar(500)
		DECLARE @SRC_ENTY varchar(500)
		DECLARE @TGT_ENTY varchar(500)
		DECLARE @ERROR_PROCEDURE_NAME AS varchar(60) = 'EDAA_ETL.PROC_FCT_DLY_ITM_SKU_STR_DF_INV_QTY_AGG_LOAD'
		DECLARE @ERROR_LINE AS int
		DECLARE @ERROR_MSG AS nvarchar(max)
		DECLARE @DT_LST_WEEKEND AS INT
        SET @DT_LST_WEEKEND = CAST(REPLACE(CONVERT(date, DATEADD(DAY, DATEDIFF(DAY, 5, GETDATE()) / 7 * 7, 5)),'-','') AS INT)

		/*Audit Log Start*/
		EXEC EDAA_CNTL.SP_AUDIT_DATA_LOAD_START @EXEC_LYR = 'EDAA_PRES',
												@EXEC_JOB = 'PROC_FCT_DLY_ITM_SKU_STR_DF_INV_QTY_AGG_LOAD',
												@SRC_ENTY = 'FCT_DSTB_CTR_INV_QTY_TY_LY_FSC',
												@TGT_ENTY = 'FCT_DSTB_CTR_INV_QTY_TY_LY_FSC_AGG',
												@NEW_AUD_SKY = @NEW_AUD_SKY OUTPUT;

		--TRUNCATE TABLE
		TRUNCATE TABLE [EDAA_PRES].[FCT_DSTB_CTR_INV_QTY_TY_LY_FSC_AGG]

		;WITH CTE1
		AS (
		     SELECT
				STR_ID,
				P_ID,
				PRE_DEF_ID,
				(SUM(Inv.DSTB_CTR_FNC_CHRG_AM_TY_FSC)/ NULLIF(COUNT(DT_SK),0)) AS [AVG_DSTB_CTR_FNC_CHRG_AM_TY_FSC],
				(SUM(Inv.DSTB_CTR_FNC_CHRG_AM_LY_FSC)/ NULLIF(COUNT(LY_DT_SK),0)) AS [AVG_DSTB_CTR_FNC_CHRG_AM_LY_FSC],
				(SUM(Inv.DSTB_CTR_FNC_CR_AM_TY_FSC) / NULLIF(COUNT(DT_SK),0)) AS [AVG_DSTB_CTR_FNC_CR_AM_TY_FSC],
				(SUM(Inv.DSTB_CTR_FNC_CR_AM_LY_FSC)/ NULLIF(COUNT(LY_DT_SK),0)) AS [AVG_DSTB_CTR_FNC_CR_AM_LY_FSC],
				(SUM(Inv.DSTB_CTR_STG_CHRG_AM_TY_FSC)/ NULLIF(COUNT(DT_SK),0)) AS [AVG_DSTB_CTR_STG_CHRG_AM_TY_FSC],
				(SUM(Inv.DSTB_CTR_STG_CHRG_AM_LY_FSC)/ NULLIF(COUNT(LY_DT_SK),0)) AS [AVG_DSTB_CTR_STG_CHRG_AM_LY_FSC],
				(SUM(Inv.EST_DLVY_CST_AM_TY_FSC)/ NULLIF(COUNT(DT_SK),0)) AS [AVG_EST_DLVY_CST_AM_TY_FSC],
				(SUM(Inv.EST_DLVY_CST_AM_LY_FSC)/ NULLIF(COUNT(LY_DT_SK),0)) AS [AVG_EST_DLVY_CST_AM_LY_FSC],
				(SUM(Inv.TRNSF_QT_TY_FSC)/ NULLIF(COUNT(DT_SK),0)) AS [AVG_TRNSF_QT_TY_FSC],
				(SUM(Inv.TRNSF_QT_LY_FSC)/ NULLIF(COUNT(LY_DT_SK),0)) AS [AVG_TRNSF_QT_LY_FSC],
				(SUM(Inv.WK_OUT_OF_STK_QT_TY_FSC)/ NULLIF(COUNT(DT_SK),0)) AS [AVG_WK_OUT_OF_STK_QT_TY_FSC],
				(SUM(Inv.WK_OUT_OF_STK_QT_LY_FSC)/ NULLIF(COUNT(LY_DT_SK),0)) AS [AVG_WK_OUT_OF_STK_QT_LY_FSC],
				(SUM(Inv.WK_OUT_OF_STK_SBS_QT_TY_FSC)/ NULLIF(COUNT(DT_SK),0)) AS [AVG_WK_OUT_OF_STK_SBS_QT_TY_FSC],
				(SUM(Inv.WK_OUT_OF_STK_SBS_QT_LY_FSC)/ NULLIF(COUNT(LY_DT_SK),0)) AS [AVG_WK_OUT_OF_STK_SBS_QT_LY_FSC],
				(SUM(Inv.WK_OVRD_SBS_QT_TY_FSC)/ NULLIF(COUNT(DT_SK),0)) AS [AVG_WK_OVRD_SBS_QT_TY_FSC],
				(SUM(Inv.WK_OVRD_SBS_QT_LY_FSC)/ NULLIF(COUNT(LY_DT_SK),0)) AS [AVG_WK_OVRD_SBS_QT_LY_FSC],
				(SUM(Inv.WK_ADJ_QT_TY_FSC)/ NULLIF(COUNT(DT_SK),0)) AS [AVG_WK_ADJ_QT_TY_FSC],
				(SUM(Inv.WK_ADJ_QT_LY_FSC)/ NULLIF(COUNT(LY_DT_SK),0)) AS [AVG_WK_ADJ_QT_LY_FSC],
				(SUM(Inv.WK_DSTB_CTR_MVMT_QT_TY_FSC)/ NULLIF(COUNT(DT_SK),0)) AS [AVG_WK_DSTB_CTR_MVMT_QT_TY_FSC],
				(SUM(Inv.WK_DSTB_CTR_MVMT_QT_LY_FSC)/ NULLIF(COUNT(LY_DT_SK),0)) AS [AVG_WK_DSTB_CTR_MVMT_QT_LY_FSC],
				(SUM(Inv.WK_MVMT_CST_AM_TY_FSC)/ NULLIF(COUNT(DT_SK),0)) AS [AVG_WK_MVMT_CST_AM_TY_FSC],
				(SUM(Inv.WK_MVMT_CST_AM_LY_FSC)/ NULLIF(COUNT(LY_DT_SK),0)) AS [AVG_WK_MVMT_CST_AM_LY_FSC],
				(SUM(Inv.WK_MVMT_RTL_AM_TY_FSC)/ NULLIF(COUNT(DT_SK),0)) AS [AVG_WK_MVMT_RTL_AM_TY_FSC],
				(SUM(Inv.WK_MVMT_RTL_AM_LY_FSC)/ NULLIF(COUNT(LY_DT_SK),0)) AS [AVG_WK_MVMT_RTL_AM_LY_FSC],
				(SUM(Inv.WK_RCV_QT_TY_FSC)/ NULLIF(COUNT(DT_SK),0)) AS [AVG_WK_RCV_QT_TY_FSC],
				(SUM(Inv.WK_RCV_QT_LY_FSC)/ NULLIF(COUNT(LY_DT_SK),0)) AS [AVG_WK_RCV_QT_LY_FSC],
				(SUM(Inv.DSTB_CTR_BAL_ON_HND_QT_TY_FSC)/ NULLIF(COUNT(DT_SK),0)) AS [AVG_DSTB_CTR_BAL_ON_HND_QT_TY_FSC],
				(SUM(Inv.DSTB_CTR_BAL_ON_HND_QT_LY_FSC)/ NULLIF(COUNT(LY_DT_SK),0)) AS [AVG_DSTB_CTR_BAL_ON_HND_QT_LY_FSC],
				(SUM(Inv.RTL_SVC_CTR_BAL_ON_HND_QT_TY_FSC)/ NULLIF(COUNT(DT_SK),0)) AS [AVG_RTL_SVC_CTR_BAL_ON_HND_QT_TY_FSC],
				(SUM(Inv.RTL_SVC_CTR_BAL_ON_HND_QT_LY_FSC)/ NULLIF(COUNT(LY_DT_SK),0)) AS [AVG_RTL_SVC_CTR_BAL_ON_HND_QT_LY_FSC],
				(SUM(Inv.DSTB_CTR_CST_AM_TY_FSC)/ NULLIF(COUNT(DT_SK),0)) AS [AVG_DSTB_CTR_CST_AM_TY_FSC],
				(SUM(Inv.DSTB_CTR_CST_AM_LY_FSC)/ NULLIF(COUNT(LY_DT_SK),0)) AS [AVG_DSTB_CTR_CST_AM_LY_FSC],
				(SUM(Inv.DSTB_CTR_FNC_CHRG_AM_LY_HLDY)/ NULLIF(COUNT(LY_DT_SK_HLDY),0)) AS [AVG_DSTB_CTR_FNC_CHRG_AM_LY_HLDY],
				(SUM(Inv.DSTB_CTR_FNC_CR_AM_LY_HLDY)/ NULLIF(COUNT(LY_DT_SK_HLDY),0)) AS [AVG_DSTB_CTR_FNC_CR_AM_LY_HLDY],
				(SUM(Inv.DSTB_CTR_STG_CHRG_AM_LY_HLDY)/ NULLIF(COUNT(LY_DT_SK_HLDY),0)) AS [AVG_DSTB_CTR_STG_CHRG_AM_LY_HLDY],
				(SUM(Inv.EST_DLVY_CST_AM_LY_HLDY)/ NULLIF(COUNT(LY_DT_SK_HLDY),0)) AS [AVG_EST_DLVY_CST_AM_LY_HLDY],
				(SUM(Inv.TRNSF_QT_LY_HLDY)/ NULLIF(COUNT(LY_DT_SK_HLDY),0)) AS [AVG_TRNSF_QT_LY_HLDY],
				(SUM(Inv.WK_OUT_OF_STK_QT_LY_HLDY)/ NULLIF(COUNT(LY_DT_SK_HLDY),0)) AS [AVG_WK_OUT_OF_STK_QT_LY_HLDY],
				(SUM(Inv.WK_OUT_OF_STK_SBS_QT_LY_HLDY)/ NULLIF(COUNT(LY_DT_SK_HLDY),0)) AS [AVG_WK_OUT_OF_STK_SBS_QT_LY_HLDY],
				(SUM(Inv.WK_OVRD_SBS_QT_LY_HLDY)/ NULLIF(COUNT(LY_DT_SK_HLDY),0)) AS [AVG_WK_OVRD_SBS_QT_LY_HLDY],
				(SUM(Inv.WK_ADJ_QT_LY_HLDY)/ NULLIF(COUNT(LY_DT_SK_HLDY),0)) AS [AVG_WK_ADJ_QT_LY_HLDY],
				(SUM(Inv.WK_DSTB_CTR_MVMT_QT_LY_HLDY)/ NULLIF(COUNT(LY_DT_SK_HLDY),0)) AS [AVG_WK_DSTB_CTR_MVMT_QT_LY_HLDY],
				(SUM(Inv.WK_MVMT_CST_AM_LY_HLDY)/ NULLIF(COUNT(LY_DT_SK_HLDY),0)) AS [AVG_WK_MVMT_CST_AM_LY_HLDY],
				(SUM(Inv.WK_MVMT_RTL_AM_LY_HLDY)/ NULLIF(COUNT(LY_DT_SK_HLDY),0)) AS [AVG_WK_MVMT_RTL_AM_LY_HLDY],
				(SUM(Inv.WK_RCV_QT_LY_HLDY)/ NULLIF(COUNT(LY_DT_SK_HLDY),0)) AS [AVG_WK_RCV_QT_LY_HLDY],
				(SUM(Inv.DSTB_CTR_BAL_ON_HND_QT_LY_HLDY)/ NULLIF(COUNT(LY_DT_SK_HLDY),0)) AS [AVG_DSTB_CTR_BAL_ON_HND_QT_LY_HLDY],
				(SUM(Inv.RTL_SVC_CTR_BAL_ON_HND_QT_LY_HLDY)/ NULLIF(COUNT(LY_DT_SK_HLDY),0)) AS [AVG_RTL_SVC_CTR_BAL_ON_HND_QT_LY_HLDY],
				(SUM(Inv.DSTB_CTR_CST_AM_LY_HLDY)/ NULLIF(COUNT(LY_DT_SK_HLDY),0)) AS [AVG_DSTB_CTR_CST_AM_LY_HLDY],
				(SUM(Inv.DSTB_CTR_FNC_CHRG_AM_LY_CAL)/ NULLIF(COUNT(LY_DT_SK_CAL),0)) AS [AVG_DSTB_CTR_FNC_CHRG_AM_LY_CAL],
				(SUM(Inv.DSTB_CTR_FNC_CR_AM_LY_CAL)/ NULLIF(COUNT(LY_DT_SK_CAL),0)) AS [AVG_DSTB_CTR_FNC_CR_AM_LY_CAL],
				(SUM(Inv.DSTB_CTR_STG_CHRG_AM_LY_CAL)/ NULLIF(COUNT(LY_DT_SK_CAL),0)) AS [AVG_DSTB_CTR_STG_CHRG_AM_LY_CAL],
				(SUM(Inv.EST_DLVY_CST_AM_LY_CAL)/ NULLIF(COUNT(LY_DT_SK_CAL),0)) AS [AVG_EST_DLVY_CST_AM_LY_CAL],
				(SUM(Inv.TRNSF_QT_LY_CAL)/ NULLIF(COUNT(LY_DT_SK_CAL),0)) AS [AVG_TRNSF_QT_LY_CAL],
				(SUM(Inv.WK_OUT_OF_STK_QT_LY_CAL)/ NULLIF(COUNT(LY_DT_SK_CAL),0)) AS [AVG_WK_OUT_OF_STK_QT_LY_CAL],
				(SUM(Inv.WK_OUT_OF_STK_SBS_QT_LY_CAL)/ NULLIF(COUNT(LY_DT_SK_CAL),0)) AS [AVG_WK_OUT_OF_STK_SBS_QT_LY_CAL],
				(SUM(Inv.WK_OVRD_SBS_QT_LY_CAL)/ NULLIF(COUNT(LY_DT_SK_CAL),0)) AS [AVG_WK_OVRD_SBS_QT_LY_CAL],
				(SUM(Inv.WK_ADJ_QT_LY_CAL)/ NULLIF(COUNT(LY_DT_SK_CAL),0)) AS [AVG_WK_ADJ_QT_LY_CAL],
				(SUM(Inv.WK_DSTB_CTR_MVMT_QT_LY_CAL)/ NULLIF(COUNT(LY_DT_SK_CAL),0)) AS [AVG_WK_DSTB_CTR_MVMT_QT_LY_CAL],
				(SUM(Inv.WK_MVMT_CST_AM_LY_CAL)/ NULLIF(COUNT(LY_DT_SK_CAL),0)) AS [AVG_WK_MVMT_CST_AM_LY_CAL],
				(SUM(Inv.WK_MVMT_RTL_AM_LY_CAL)/ NULLIF(COUNT(LY_DT_SK_CAL),0)) AS [AVG_WK_MVMT_RTL_AM_LY_CAL],
				(SUM(Inv.WK_RCV_QT_LY_CAL)/ NULLIF(COUNT(LY_DT_SK_CAL),0)) AS [AVG_WK_RCV_QT_LY_CAL],
				(SUM(Inv.DSTB_CTR_BAL_ON_HND_QT_LY_CAL)/ NULLIF(COUNT(LY_DT_SK_CAL),0)) AS [AVG_DSTB_CTR_BAL_ON_HND_QT_LY_CAL],
				(SUM(Inv.RTL_SVC_CTR_BAL_ON_HND_QT_LY_CAL)/ NULLIF(COUNT(LY_DT_SK_CAL),0)) AS [AVG_RTL_SVC_CTR_BAL_ON_HND_QT_LY_CAL],
				(SUM(Inv.DSTB_CTR_CST_AM_LY_CAL)/ NULLIF(COUNT(LY_DT_SK_CAL),0)) AS [AVG_DSTB_CTR_CST_AM_LY_CAL]


				FROM [EDAA_PRES].[FCT_DSTB_CTR_INV_QTY_TY_LY_FSC] as Inv
				inner join EDAA_PRES.V_DIM_PRE_DEF_CAL_TYP as CalTyp
					ON  Inv.DT_SK >= CalTyp.MIN_DT
					AND Inv.DT_SK <= CalTyp.MAX_DT
					AND CalTyp.PRE_DEF_NM = 'Last Week'
					--AND Inv.LY_DT_SK_HLDY <= CalTyp.MAX_DT
					AND CalTyp.AGG_TYP = 'AGG'
					GROUP BY
					STR_ID,
				    P_ID,
				    PRE_DEF_ID


UNION

           SELECT
				STR_ID,
				P_ID,
				PRE_DEF_ID,
				(SUM(Inv.DSTB_CTR_FNC_CHRG_AM_TY_FSC)/ NULLIF(COUNT(DT_SK),0)) AS [AVG_DSTB_CTR_FNC_CHRG_AM_TY_FSC],
				(SUM(Inv.DSTB_CTR_FNC_CHRG_AM_LY_FSC)/ NULLIF(COUNT(LY_DT_SK),0)) AS [AVG_DSTB_CTR_FNC_CHRG_AM_LY_FSC],
				(SUM(Inv.DSTB_CTR_FNC_CR_AM_TY_FSC) / NULLIF(COUNT(DT_SK),0)) AS [AVG_DSTB_CTR_FNC_CR_AM_TY_FSC],
				(SUM(Inv.DSTB_CTR_FNC_CR_AM_LY_FSC)/ NULLIF(COUNT(LY_DT_SK),0)) AS [AVG_DSTB_CTR_FNC_CR_AM_LY_FSC],
				(SUM(Inv.DSTB_CTR_STG_CHRG_AM_TY_FSC)/ NULLIF(COUNT(DT_SK),0)) AS [AVG_DSTB_CTR_STG_CHRG_AM_TY_FSC],
				(SUM(Inv.DSTB_CTR_STG_CHRG_AM_LY_FSC)/ NULLIF(COUNT(LY_DT_SK),0)) AS [AVG_DSTB_CTR_STG_CHRG_AM_LY_FSC],
				(SUM(Inv.EST_DLVY_CST_AM_TY_FSC)/ NULLIF(COUNT(DT_SK),0)) AS [AVG_EST_DLVY_CST_AM_TY_FSC],
				(SUM(Inv.EST_DLVY_CST_AM_LY_FSC)/ NULLIF(COUNT(LY_DT_SK),0)) AS [AVG_EST_DLVY_CST_AM_LY_FSC],
				(SUM(Inv.TRNSF_QT_TY_FSC)/ NULLIF(COUNT(DT_SK),0)) AS [AVG_TRNSF_QT_TY_FSC],
				(SUM(Inv.TRNSF_QT_LY_FSC)/ NULLIF(COUNT(LY_DT_SK),0)) AS [AVG_TRNSF_QT_LY_FSC],
				(SUM(Inv.WK_OUT_OF_STK_QT_TY_FSC)/ NULLIF(COUNT(DT_SK),0)) AS [AVG_WK_OUT_OF_STK_QT_TY_FSC],
				(SUM(Inv.WK_OUT_OF_STK_QT_LY_FSC)/ NULLIF(COUNT(LY_DT_SK),0)) AS [AVG_WK_OUT_OF_STK_QT_LY_FSC],
				(SUM(Inv.WK_OUT_OF_STK_SBS_QT_TY_FSC)/ NULLIF(COUNT(DT_SK),0)) AS [AVG_WK_OUT_OF_STK_SBS_QT_TY_FSC],
				(SUM(Inv.WK_OUT_OF_STK_SBS_QT_LY_FSC)/ NULLIF(COUNT(LY_DT_SK),0)) AS [AVG_WK_OUT_OF_STK_SBS_QT_LY_FSC],
				(SUM(Inv.WK_OVRD_SBS_QT_TY_FSC)/ NULLIF(COUNT(DT_SK),0)) AS [AVG_WK_OVRD_SBS_QT_TY_FSC],
				(SUM(Inv.WK_OVRD_SBS_QT_LY_FSC)/ NULLIF(COUNT(LY_DT_SK),0)) AS [AVG_WK_OVRD_SBS_QT_LY_FSC],
				(SUM(Inv.WK_ADJ_QT_TY_FSC)/ NULLIF(COUNT(DT_SK),0)) AS [AVG_WK_ADJ_QT_TY_FSC],
				(SUM(Inv.WK_ADJ_QT_LY_FSC)/ NULLIF(COUNT(LY_DT_SK),0)) AS [AVG_WK_ADJ_QT_LY_FSC],
				(SUM(Inv.WK_DSTB_CTR_MVMT_QT_TY_FSC)/ NULLIF(COUNT(DT_SK),0)) AS [AVG_WK_DSTB_CTR_MVMT_QT_TY_FSC],
				(SUM(Inv.WK_DSTB_CTR_MVMT_QT_LY_FSC)/ NULLIF(COUNT(LY_DT_SK),0)) AS [AVG_WK_DSTB_CTR_MVMT_QT_LY_FSC],
				(SUM(Inv.WK_MVMT_CST_AM_TY_FSC)/ NULLIF(COUNT(DT_SK),0)) AS [AVG_WK_MVMT_CST_AM_TY_FSC],
				(SUM(Inv.WK_MVMT_CST_AM_LY_FSC)/ NULLIF(COUNT(LY_DT_SK),0)) AS [AVG_WK_MVMT_CST_AM_LY_FSC],
				(SUM(Inv.WK_MVMT_RTL_AM_TY_FSC)/ NULLIF(COUNT(DT_SK),0)) AS [AVG_WK_MVMT_RTL_AM_TY_FSC],
				(SUM(Inv.WK_MVMT_RTL_AM_LY_FSC)/ NULLIF(COUNT(LY_DT_SK),0)) AS [AVG_WK_MVMT_RTL_AM_LY_FSC],
				(SUM(Inv.WK_RCV_QT_TY_FSC)/ NULLIF(COUNT(DT_SK),0)) AS [AVG_WK_RCV_QT_TY_FSC],
				(SUM(Inv.WK_RCV_QT_LY_FSC)/ NULLIF(COUNT(LY_DT_SK),0)) AS [AVG_WK_RCV_QT_LY_FSC],
				(SUM(Inv.DSTB_CTR_BAL_ON_HND_QT_TY_FSC)/ NULLIF(COUNT(DT_SK),0)) AS [AVG_DSTB_CTR_BAL_ON_HND_QT_TY_FSC],
				(SUM(Inv.DSTB_CTR_BAL_ON_HND_QT_LY_FSC)/ NULLIF(COUNT(LY_DT_SK),0)) AS [AVG_DSTB_CTR_BAL_ON_HND_QT_LY_FSC],
				(SUM(Inv.RTL_SVC_CTR_BAL_ON_HND_QT_TY_FSC)/ NULLIF(COUNT(DT_SK),0)) AS [AVG_RTL_SVC_CTR_BAL_ON_HND_QT_TY_FSC],
				(SUM(Inv.RTL_SVC_CTR_BAL_ON_HND_QT_LY_FSC)/ NULLIF(COUNT(LY_DT_SK),0)) AS [AVG_RTL_SVC_CTR_BAL_ON_HND_QT_LY_FSC],
				(SUM(Inv.DSTB_CTR_CST_AM_TY_FSC)/ NULLIF(COUNT(DT_SK),0)) AS [AVG_DSTB_CTR_CST_AM_TY_FSC],
				(SUM(Inv.DSTB_CTR_CST_AM_LY_FSC)/ NULLIF(COUNT(LY_DT_SK),0)) AS [AVG_DSTB_CTR_CST_AM_LY_FSC],
				(SUM(Inv.DSTB_CTR_FNC_CHRG_AM_LY_HLDY)/ NULLIF(COUNT(LY_DT_SK_HLDY),0)) AS [AVG_DSTB_CTR_FNC_CHRG_AM_LY_HLDY],
				(SUM(Inv.DSTB_CTR_FNC_CR_AM_LY_HLDY)/ NULLIF(COUNT(LY_DT_SK_HLDY),0)) AS [AVG_DSTB_CTR_FNC_CR_AM_LY_HLDY],
				(SUM(Inv.DSTB_CTR_STG_CHRG_AM_LY_HLDY)/ NULLIF(COUNT(LY_DT_SK_HLDY),0)) AS [AVG_DSTB_CTR_STG_CHRG_AM_LY_HLDY],
				(SUM(Inv.EST_DLVY_CST_AM_LY_HLDY)/ NULLIF(COUNT(LY_DT_SK_HLDY),0)) AS [AVG_EST_DLVY_CST_AM_LY_HLDY],
				(SUM(Inv.TRNSF_QT_LY_HLDY)/ NULLIF(COUNT(LY_DT_SK_HLDY),0)) AS [AVG_TRNSF_QT_LY_HLDY],
				(SUM(Inv.WK_OUT_OF_STK_QT_LY_HLDY)/ NULLIF(COUNT(LY_DT_SK_HLDY),0)) AS [AVG_WK_OUT_OF_STK_QT_LY_HLDY],
				(SUM(Inv.WK_OUT_OF_STK_SBS_QT_LY_HLDY)/ NULLIF(COUNT(LY_DT_SK_HLDY),0)) AS [AVG_WK_OUT_OF_STK_SBS_QT_LY_HLDY],
				(SUM(Inv.WK_OVRD_SBS_QT_LY_HLDY)/ NULLIF(COUNT(LY_DT_SK_HLDY),0)) AS [AVG_WK_OVRD_SBS_QT_LY_HLDY],
				(SUM(Inv.WK_ADJ_QT_LY_HLDY)/ NULLIF(COUNT(LY_DT_SK_HLDY),0)) AS [AVG_WK_ADJ_QT_LY_HLDY],
				(SUM(Inv.WK_DSTB_CTR_MVMT_QT_LY_HLDY)/ NULLIF(COUNT(LY_DT_SK_HLDY),0)) AS [AVG_WK_DSTB_CTR_MVMT_QT_LY_HLDY],
				(SUM(Inv.WK_MVMT_CST_AM_LY_HLDY)/ NULLIF(COUNT(LY_DT_SK_HLDY),0)) AS [AVG_WK_MVMT_CST_AM_LY_HLDY],
				(SUM(Inv.WK_MVMT_RTL_AM_LY_HLDY)/ NULLIF(COUNT(LY_DT_SK_HLDY),0)) AS [AVG_WK_MVMT_RTL_AM_LY_HLDY],
				(SUM(Inv.WK_RCV_QT_LY_HLDY)/ NULLIF(COUNT(LY_DT_SK_HLDY),0)) AS [AVG_WK_RCV_QT_LY_HLDY],
				(SUM(Inv.DSTB_CTR_BAL_ON_HND_QT_LY_HLDY)/ NULLIF(COUNT(LY_DT_SK_HLDY),0)) AS [AVG_DSTB_CTR_BAL_ON_HND_QT_LY_HLDY],
				(SUM(Inv.RTL_SVC_CTR_BAL_ON_HND_QT_LY_HLDY)/ NULLIF(COUNT(LY_DT_SK_HLDY),0)) AS [AVG_RTL_SVC_CTR_BAL_ON_HND_QT_LY_HLDY],
				(SUM(Inv.DSTB_CTR_CST_AM_LY_HLDY)/ NULLIF(COUNT(LY_DT_SK_HLDY),0)) AS [AVG_DSTB_CTR_CST_AM_LY_HLDY],
				(SUM(Inv.DSTB_CTR_FNC_CHRG_AM_LY_CAL)/ NULLIF(COUNT(LY_DT_SK_CAL),0)) AS [AVG_DSTB_CTR_FNC_CHRG_AM_LY_CAL],
				(SUM(Inv.DSTB_CTR_FNC_CR_AM_LY_CAL)/ NULLIF(COUNT(LY_DT_SK_CAL),0)) AS [AVG_DSTB_CTR_FNC_CR_AM_LY_CAL],
				(SUM(Inv.DSTB_CTR_STG_CHRG_AM_LY_CAL)/ NULLIF(COUNT(LY_DT_SK_CAL),0)) AS [AVG_DSTB_CTR_STG_CHRG_AM_LY_CAL],
				(SUM(Inv.EST_DLVY_CST_AM_LY_CAL)/ NULLIF(COUNT(LY_DT_SK_CAL),0)) AS [AVG_EST_DLVY_CST_AM_LY_CAL],
				(SUM(Inv.TRNSF_QT_LY_CAL)/ NULLIF(COUNT(LY_DT_SK_CAL),0)) AS [AVG_TRNSF_QT_LY_CAL],
				(SUM(Inv.WK_OUT_OF_STK_QT_LY_CAL)/ NULLIF(COUNT(LY_DT_SK_CAL),0)) AS [AVG_WK_OUT_OF_STK_QT_LY_CAL],
				(SUM(Inv.WK_OUT_OF_STK_SBS_QT_LY_CAL)/ NULLIF(COUNT(LY_DT_SK_CAL),0)) AS [AVG_WK_OUT_OF_STK_SBS_QT_LY_CAL],
				(SUM(Inv.WK_OVRD_SBS_QT_LY_CAL)/ NULLIF(COUNT(LY_DT_SK_CAL),0)) AS [AVG_WK_OVRD_SBS_QT_LY_CAL],
				(SUM(Inv.WK_ADJ_QT_LY_CAL)/ NULLIF(COUNT(LY_DT_SK_CAL),0)) AS [AVG_WK_ADJ_QT_LY_CAL],
				(SUM(Inv.WK_DSTB_CTR_MVMT_QT_LY_CAL)/ NULLIF(COUNT(LY_DT_SK_CAL),0)) AS [AVG_WK_DSTB_CTR_MVMT_QT_LY_CAL],
				(SUM(Inv.WK_MVMT_CST_AM_LY_CAL)/ NULLIF(COUNT(LY_DT_SK_CAL),0)) AS [AVG_WK_MVMT_CST_AM_LY_CAL],
				(SUM(Inv.WK_MVMT_RTL_AM_LY_CAL)/ NULLIF(COUNT(LY_DT_SK_CAL),0)) AS [AVG_WK_MVMT_RTL_AM_LY_CAL],
				(SUM(Inv.WK_RCV_QT_LY_CAL)/ NULLIF(COUNT(LY_DT_SK_CAL),0)) AS [AVG_WK_RCV_QT_LY_CAL],
				(SUM(Inv.DSTB_CTR_BAL_ON_HND_QT_LY_CAL)/ NULLIF(COUNT(LY_DT_SK_CAL),0)) AS [AVG_DSTB_CTR_BAL_ON_HND_QT_LY_CAL],
				(SUM(Inv.RTL_SVC_CTR_BAL_ON_HND_QT_LY_CAL)/ NULLIF(COUNT(LY_DT_SK_CAL),0)) AS [AVG_RTL_SVC_CTR_BAL_ON_HND_QT_LY_CAL],
				(SUM(Inv.DSTB_CTR_CST_AM_LY_CAL)/ NULLIF(COUNT(LY_DT_SK_CAL),0)) AS [AVG_DSTB_CTR_CST_AM_LY_CAL]

				FROM EDAA_PRES.FCT_DSTB_CTR_INV_QTY_TY_LY_FSC as Inv
				inner join EDAA_PRES.V_DIM_PRE_DEF_CAL_TYP as CalTyp
					ON  Inv.DT_SK >= CalTyp.MIN_DT
					AND Inv.DT_SK <= CalTyp.MAX_DT
					--AND Inv.DT_SK <= FORMAT(GETDATE(),'yyyyMMdd')
					AND CalTyp.PRE_DEF_NM = 'FYTD'
					--AND Inv.LY_DT_SK_HLDY <= CalTyp.MAX_DT
					AND CalTyp.AGG_TYP = 'AGG'
					GROUP BY
					STR_ID,
				    P_ID,
				    PRE_DEF_ID

UNION

           SELECT
				STR_ID,
				P_ID,
				PRE_DEF_ID,
				(SUM(Inv.DSTB_CTR_FNC_CHRG_AM_TY_FSC)/ NULLIF(COUNT(DT_SK),0)) AS [AVG_DSTB_CTR_FNC_CHRG_AM_TY_FSC],
				(SUM(Inv.DSTB_CTR_FNC_CHRG_AM_LY_FSC)/ NULLIF(COUNT(LY_DT_SK),0)) AS [AVG_DSTB_CTR_FNC_CHRG_AM_LY_FSC],
				(SUM(Inv.DSTB_CTR_FNC_CR_AM_TY_FSC) / NULLIF(COUNT(DT_SK),0)) AS [AVG_DSTB_CTR_FNC_CR_AM_TY_FSC],
				(SUM(Inv.DSTB_CTR_FNC_CR_AM_LY_FSC)/ NULLIF(COUNT(LY_DT_SK),0)) AS [AVG_DSTB_CTR_FNC_CR_AM_LY_FSC],
				(SUM(Inv.DSTB_CTR_STG_CHRG_AM_TY_FSC)/ NULLIF(COUNT(DT_SK),0)) AS [AVG_DSTB_CTR_STG_CHRG_AM_TY_FSC],
				(SUM(Inv.DSTB_CTR_STG_CHRG_AM_LY_FSC)/ NULLIF(COUNT(LY_DT_SK),0)) AS [AVG_DSTB_CTR_STG_CHRG_AM_LY_FSC],
				(SUM(Inv.EST_DLVY_CST_AM_TY_FSC)/ NULLIF(COUNT(DT_SK),0)) AS [AVG_EST_DLVY_CST_AM_TY_FSC],
				(SUM(Inv.EST_DLVY_CST_AM_LY_FSC)/ NULLIF(COUNT(LY_DT_SK),0)) AS [AVG_EST_DLVY_CST_AM_LY_FSC],
				(SUM(Inv.TRNSF_QT_TY_FSC)/ NULLIF(COUNT(DT_SK),0)) AS [AVG_TRNSF_QT_TY_FSC],
				(SUM(Inv.TRNSF_QT_LY_FSC)/ NULLIF(COUNT(LY_DT_SK),0)) AS [AVG_TRNSF_QT_LY_FSC],
				(SUM(Inv.WK_OUT_OF_STK_QT_TY_FSC)/ NULLIF(COUNT(DT_SK),0)) AS [AVG_WK_OUT_OF_STK_QT_TY_FSC],
				(SUM(Inv.WK_OUT_OF_STK_QT_LY_FSC)/ NULLIF(COUNT(LY_DT_SK),0)) AS [AVG_WK_OUT_OF_STK_QT_LY_FSC],
				(SUM(Inv.WK_OUT_OF_STK_SBS_QT_TY_FSC)/ NULLIF(COUNT(DT_SK),0)) AS [AVG_WK_OUT_OF_STK_SBS_QT_TY_FSC],
				(SUM(Inv.WK_OUT_OF_STK_SBS_QT_LY_FSC)/ NULLIF(COUNT(LY_DT_SK),0)) AS [AVG_WK_OUT_OF_STK_SBS_QT_LY_FSC],
				(SUM(Inv.WK_OVRD_SBS_QT_TY_FSC)/ NULLIF(COUNT(DT_SK),0)) AS [AVG_WK_OVRD_SBS_QT_TY_FSC],
				(SUM(Inv.WK_OVRD_SBS_QT_LY_FSC)/ NULLIF(COUNT(LY_DT_SK),0)) AS [AVG_WK_OVRD_SBS_QT_LY_FSC],
				(SUM(Inv.WK_ADJ_QT_TY_FSC)/ NULLIF(COUNT(DT_SK),0)) AS [AVG_WK_ADJ_QT_TY_FSC],
				(SUM(Inv.WK_ADJ_QT_LY_FSC)/ NULLIF(COUNT(LY_DT_SK),0)) AS [AVG_WK_ADJ_QT_LY_FSC],
				(SUM(Inv.WK_DSTB_CTR_MVMT_QT_TY_FSC)/ NULLIF(COUNT(DT_SK),0)) AS [AVG_WK_DSTB_CTR_MVMT_QT_TY_FSC],
				(SUM(Inv.WK_DSTB_CTR_MVMT_QT_LY_FSC)/ NULLIF(COUNT(LY_DT_SK),0)) AS [AVG_WK_DSTB_CTR_MVMT_QT_LY_FSC],
				(SUM(Inv.WK_MVMT_CST_AM_TY_FSC)/ NULLIF(COUNT(DT_SK),0)) AS [AVG_WK_MVMT_CST_AM_TY_FSC],
				(SUM(Inv.WK_MVMT_CST_AM_LY_FSC)/ NULLIF(COUNT(LY_DT_SK),0)) AS [AVG_WK_MVMT_CST_AM_LY_FSC],
				(SUM(Inv.WK_MVMT_RTL_AM_TY_FSC)/ NULLIF(COUNT(DT_SK),0)) AS [AVG_WK_MVMT_RTL_AM_TY_FSC],
				(SUM(Inv.WK_MVMT_RTL_AM_LY_FSC)/ NULLIF(COUNT(LY_DT_SK),0)) AS [AVG_WK_MVMT_RTL_AM_LY_FSC],
				(SUM(Inv.WK_RCV_QT_TY_FSC)/ NULLIF(COUNT(DT_SK),0)) AS [AVG_WK_RCV_QT_TY_FSC],
				(SUM(Inv.WK_RCV_QT_LY_FSC)/ NULLIF(COUNT(LY_DT_SK),0)) AS [AVG_WK_RCV_QT_LY_FSC],
				(SUM(Inv.DSTB_CTR_BAL_ON_HND_QT_TY_FSC)/ NULLIF(COUNT(DT_SK),0)) AS [AVG_DSTB_CTR_BAL_ON_HND_QT_TY_FSC],
				(SUM(Inv.DSTB_CTR_BAL_ON_HND_QT_LY_FSC)/ NULLIF(COUNT(LY_DT_SK),0)) AS [AVG_DSTB_CTR_BAL_ON_HND_QT_LY_FSC],
				(SUM(Inv.RTL_SVC_CTR_BAL_ON_HND_QT_TY_FSC)/ NULLIF(COUNT(DT_SK),0)) AS [AVG_RTL_SVC_CTR_BAL_ON_HND_QT_TY_FSC],
				(SUM(Inv.RTL_SVC_CTR_BAL_ON_HND_QT_LY_FSC)/ NULLIF(COUNT(LY_DT_SK),0)) AS [AVG_RTL_SVC_CTR_BAL_ON_HND_QT_LY_FSC],
				(SUM(Inv.DSTB_CTR_CST_AM_TY_FSC)/ NULLIF(COUNT(DT_SK),0)) AS [AVG_DSTB_CTR_CST_AM_TY_FSC],
				(SUM(Inv.DSTB_CTR_CST_AM_LY_FSC)/ NULLIF(COUNT(LY_DT_SK),0)) AS [AVG_DSTB_CTR_CST_AM_LY_FSC],
				(SUM(Inv.DSTB_CTR_FNC_CHRG_AM_LY_HLDY)/ NULLIF(COUNT(LY_DT_SK_HLDY),0)) AS [AVG_DSTB_CTR_FNC_CHRG_AM_LY_HLDY],
				(SUM(Inv.DSTB_CTR_FNC_CR_AM_LY_HLDY)/ NULLIF(COUNT(LY_DT_SK_HLDY),0)) AS [AVG_DSTB_CTR_FNC_CR_AM_LY_HLDY],
				(SUM(Inv.DSTB_CTR_STG_CHRG_AM_LY_HLDY)/ NULLIF(COUNT(LY_DT_SK_HLDY),0)) AS [AVG_DSTB_CTR_STG_CHRG_AM_LY_HLDY],
				(SUM(Inv.EST_DLVY_CST_AM_LY_HLDY)/ NULLIF(COUNT(LY_DT_SK_HLDY),0)) AS [AVG_EST_DLVY_CST_AM_LY_HLDY],
				(SUM(Inv.TRNSF_QT_LY_HLDY)/ NULLIF(COUNT(LY_DT_SK_HLDY),0)) AS [AVG_TRNSF_QT_LY_HLDY],
				(SUM(Inv.WK_OUT_OF_STK_QT_LY_HLDY)/ NULLIF(COUNT(LY_DT_SK_HLDY),0)) AS [AVG_WK_OUT_OF_STK_QT_LY_HLDY],
				(SUM(Inv.WK_OUT_OF_STK_SBS_QT_LY_HLDY)/ NULLIF(COUNT(LY_DT_SK_HLDY),0)) AS [AVG_WK_OUT_OF_STK_SBS_QT_LY_HLDY],
				(SUM(Inv.WK_OVRD_SBS_QT_LY_HLDY)/ NULLIF(COUNT(LY_DT_SK_HLDY),0)) AS [AVG_WK_OVRD_SBS_QT_LY_HLDY],
				(SUM(Inv.WK_ADJ_QT_LY_HLDY)/ NULLIF(COUNT(LY_DT_SK_HLDY),0)) AS [AVG_WK_ADJ_QT_LY_HLDY],
				(SUM(Inv.WK_DSTB_CTR_MVMT_QT_LY_HLDY)/ NULLIF(COUNT(LY_DT_SK_HLDY),0)) AS [AVG_WK_DSTB_CTR_MVMT_QT_LY_HLDY],
				(SUM(Inv.WK_MVMT_CST_AM_LY_HLDY)/ NULLIF(COUNT(LY_DT_SK_HLDY),0)) AS [AVG_WK_MVMT_CST_AM_LY_HLDY],
				(SUM(Inv.WK_MVMT_RTL_AM_LY_HLDY)/ NULLIF(COUNT(LY_DT_SK_HLDY),0)) AS [AVG_WK_MVMT_RTL_AM_LY_HLDY],
				(SUM(Inv.WK_RCV_QT_LY_HLDY)/ NULLIF(COUNT(LY_DT_SK_HLDY),0)) AS [AVG_WK_RCV_QT_LY_HLDY],
				(SUM(Inv.DSTB_CTR_BAL_ON_HND_QT_LY_HLDY)/ NULLIF(COUNT(LY_DT_SK_HLDY),0)) AS [AVG_DSTB_CTR_BAL_ON_HND_QT_LY_HLDY],
				(SUM(Inv.RTL_SVC_CTR_BAL_ON_HND_QT_LY_HLDY)/ NULLIF(COUNT(LY_DT_SK_HLDY),0)) AS [AVG_RTL_SVC_CTR_BAL_ON_HND_QT_LY_HLDY],
				(SUM(Inv.DSTB_CTR_CST_AM_LY_HLDY)/ NULLIF(COUNT(LY_DT_SK_HLDY),0)) AS [AVG_DSTB_CTR_CST_AM_LY_HLDY],
				(SUM(Inv.DSTB_CTR_FNC_CHRG_AM_LY_CAL)/ NULLIF(COUNT(LY_DT_SK_CAL),0)) AS [AVG_DSTB_CTR_FNC_CHRG_AM_LY_CAL],
				(SUM(Inv.DSTB_CTR_FNC_CR_AM_LY_CAL)/ NULLIF(COUNT(LY_DT_SK_CAL),0)) AS [AVG_DSTB_CTR_FNC_CR_AM_LY_CAL],
				(SUM(Inv.DSTB_CTR_STG_CHRG_AM_LY_CAL)/ NULLIF(COUNT(LY_DT_SK_CAL),0)) AS [AVG_DSTB_CTR_STG_CHRG_AM_LY_CAL],
				(SUM(Inv.EST_DLVY_CST_AM_LY_CAL)/ NULLIF(COUNT(LY_DT_SK_CAL),0)) AS [AVG_EST_DLVY_CST_AM_LY_CAL],
				(SUM(Inv.TRNSF_QT_LY_CAL)/ NULLIF(COUNT(LY_DT_SK_CAL),0)) AS [AVG_TRNSF_QT_LY_CAL],
				(SUM(Inv.WK_OUT_OF_STK_QT_LY_CAL)/ NULLIF(COUNT(LY_DT_SK_CAL),0)) AS [AVG_WK_OUT_OF_STK_QT_LY_CAL],
				(SUM(Inv.WK_OUT_OF_STK_SBS_QT_LY_CAL)/ NULLIF(COUNT(LY_DT_SK_CAL),0)) AS [AVG_WK_OUT_OF_STK_SBS_QT_LY_CAL],
				(SUM(Inv.WK_OVRD_SBS_QT_LY_CAL)/ NULLIF(COUNT(LY_DT_SK_CAL),0)) AS [AVG_WK_OVRD_SBS_QT_LY_CAL],
				(SUM(Inv.WK_ADJ_QT_LY_CAL)/ NULLIF(COUNT(LY_DT_SK_CAL),0)) AS [AVG_WK_ADJ_QT_LY_CAL],
				(SUM(Inv.WK_DSTB_CTR_MVMT_QT_LY_CAL)/ NULLIF(COUNT(LY_DT_SK_CAL),0)) AS [AVG_WK_DSTB_CTR_MVMT_QT_LY_CAL],
				(SUM(Inv.WK_MVMT_CST_AM_LY_CAL)/ NULLIF(COUNT(LY_DT_SK_CAL),0)) AS [AVG_WK_MVMT_CST_AM_LY_CAL],
				(SUM(Inv.WK_MVMT_RTL_AM_LY_CAL)/ NULLIF(COUNT(LY_DT_SK_CAL),0)) AS [AVG_WK_MVMT_RTL_AM_LY_CAL],
				(SUM(Inv.WK_RCV_QT_LY_CAL)/ NULLIF(COUNT(LY_DT_SK_CAL),0)) AS [AVG_WK_RCV_QT_LY_CAL],
				(SUM(Inv.DSTB_CTR_BAL_ON_HND_QT_LY_CAL)/ NULLIF(COUNT(LY_DT_SK_CAL),0)) AS [AVG_DSTB_CTR_BAL_ON_HND_QT_LY_CAL],
				(SUM(Inv.RTL_SVC_CTR_BAL_ON_HND_QT_LY_CAL)/ NULLIF(COUNT(LY_DT_SK_CAL),0)) AS [AVG_RTL_SVC_CTR_BAL_ON_HND_QT_LY_CAL],
				(SUM(Inv.DSTB_CTR_CST_AM_LY_CAL)/ NULLIF(COUNT(LY_DT_SK_CAL),0)) AS [AVG_DSTB_CTR_CST_AM_LY_CAL]

				FROM EDAA_PRES.[FCT_DSTB_CTR_INV_QTY_TY_LY_FSC] as Inv
				inner join EDAA_PRES.V_DIM_PRE_DEF_CAL_TYP as CalTyp
					ON  Inv.DT_SK >= CalTyp.MIN_DT
					AND Inv.DT_SK <= CalTyp.MAX_DT
					AND Inv.DT_SK <= FORMAT(GETDATE(),'yyyyMMdd')
					AND CalTyp.PRE_DEF_NM = 'QTD'
					--AND Inv.LY_DT_SK_HLDY <= CalTyp.MAX_DT
					AND CalTyp.AGG_TYP = 'AGG'
					GROUP BY
					STR_ID,
				    P_ID,
				    PRE_DEF_ID

UNION

           SELECT
				STR_ID,
				P_ID,
				PRE_DEF_ID,
				(SUM(Inv.DSTB_CTR_FNC_CHRG_AM_TY_FSC)/ NULLIF(COUNT(DT_SK),0)) AS [AVG_DSTB_CTR_FNC_CHRG_AM_TY_FSC],
				(SUM(Inv.DSTB_CTR_FNC_CHRG_AM_LY_FSC)/ NULLIF(COUNT(LY_DT_SK),0)) AS [AVG_DSTB_CTR_FNC_CHRG_AM_LY_FSC],
				(SUM(Inv.DSTB_CTR_FNC_CR_AM_TY_FSC) / NULLIF(COUNT(DT_SK),0)) AS [AVG_DSTB_CTR_FNC_CR_AM_TY_FSC],
				(SUM(Inv.DSTB_CTR_FNC_CR_AM_LY_FSC)/ NULLIF(COUNT(LY_DT_SK),0)) AS [AVG_DSTB_CTR_FNC_CR_AM_LY_FSC],
				(SUM(Inv.DSTB_CTR_STG_CHRG_AM_TY_FSC)/ NULLIF(COUNT(DT_SK),0)) AS [AVG_DSTB_CTR_STG_CHRG_AM_TY_FSC],
				(SUM(Inv.DSTB_CTR_STG_CHRG_AM_LY_FSC)/ NULLIF(COUNT(LY_DT_SK),0)) AS [AVG_DSTB_CTR_STG_CHRG_AM_LY_FSC],
				(SUM(Inv.EST_DLVY_CST_AM_TY_FSC)/ NULLIF(COUNT(DT_SK),0)) AS [AVG_EST_DLVY_CST_AM_TY_FSC],
				(SUM(Inv.EST_DLVY_CST_AM_LY_FSC)/ NULLIF(COUNT(LY_DT_SK),0)) AS [AVG_EST_DLVY_CST_AM_LY_FSC],
				(SUM(Inv.TRNSF_QT_TY_FSC)/ NULLIF(COUNT(DT_SK),0)) AS [AVG_TRNSF_QT_TY_FSC],
				(SUM(Inv.TRNSF_QT_LY_FSC)/ NULLIF(COUNT(LY_DT_SK),0)) AS [AVG_TRNSF_QT_LY_FSC],
				(SUM(Inv.WK_OUT_OF_STK_QT_TY_FSC)/ NULLIF(COUNT(DT_SK),0)) AS [AVG_WK_OUT_OF_STK_QT_TY_FSC],
				(SUM(Inv.WK_OUT_OF_STK_QT_LY_FSC)/ NULLIF(COUNT(LY_DT_SK),0)) AS [AVG_WK_OUT_OF_STK_QT_LY_FSC],
				(SUM(Inv.WK_OUT_OF_STK_SBS_QT_TY_FSC)/ NULLIF(COUNT(DT_SK),0)) AS [AVG_WK_OUT_OF_STK_SBS_QT_TY_FSC],
				(SUM(Inv.WK_OUT_OF_STK_SBS_QT_LY_FSC)/ NULLIF(COUNT(LY_DT_SK),0)) AS [AVG_WK_OUT_OF_STK_SBS_QT_LY_FSC],
				(SUM(Inv.WK_OVRD_SBS_QT_TY_FSC)/ NULLIF(COUNT(DT_SK),0)) AS [AVG_WK_OVRD_SBS_QT_TY_FSC],
				(SUM(Inv.WK_OVRD_SBS_QT_LY_FSC)/ NULLIF(COUNT(LY_DT_SK),0)) AS [AVG_WK_OVRD_SBS_QT_LY_FSC],
				(SUM(Inv.WK_ADJ_QT_TY_FSC)/ NULLIF(COUNT(DT_SK),0)) AS [AVG_WK_ADJ_QT_TY_FSC],
				(SUM(Inv.WK_ADJ_QT_LY_FSC)/ NULLIF(COUNT(LY_DT_SK),0)) AS [AVG_WK_ADJ_QT_LY_FSC],
				(SUM(Inv.WK_DSTB_CTR_MVMT_QT_TY_FSC)/ NULLIF(COUNT(DT_SK),0)) AS [AVG_WK_DSTB_CTR_MVMT_QT_TY_FSC],
				(SUM(Inv.WK_DSTB_CTR_MVMT_QT_LY_FSC)/ NULLIF(COUNT(LY_DT_SK),0)) AS [AVG_WK_DSTB_CTR_MVMT_QT_LY_FSC],
				(SUM(Inv.WK_MVMT_CST_AM_TY_FSC)/ NULLIF(COUNT(DT_SK),0)) AS [AVG_WK_MVMT_CST_AM_TY_FSC],
				(SUM(Inv.WK_MVMT_CST_AM_LY_FSC)/ NULLIF(COUNT(LY_DT_SK),0)) AS [AVG_WK_MVMT_CST_AM_LY_FSC],
				(SUM(Inv.WK_MVMT_RTL_AM_TY_FSC)/ NULLIF(COUNT(DT_SK),0)) AS [AVG_WK_MVMT_RTL_AM_TY_FSC],
				(SUM(Inv.WK_MVMT_RTL_AM_LY_FSC)/ NULLIF(COUNT(LY_DT_SK),0)) AS [AVG_WK_MVMT_RTL_AM_LY_FSC],
				(SUM(Inv.WK_RCV_QT_TY_FSC)/ NULLIF(COUNT(DT_SK),0)) AS [AVG_WK_RCV_QT_TY_FSC],
				(SUM(Inv.WK_RCV_QT_LY_FSC)/ NULLIF(COUNT(LY_DT_SK),0)) AS [AVG_WK_RCV_QT_LY_FSC],
				(SUM(Inv.DSTB_CTR_BAL_ON_HND_QT_TY_FSC)/ NULLIF(COUNT(DT_SK),0)) AS [AVG_DSTB_CTR_BAL_ON_HND_QT_TY_FSC],
				(SUM(Inv.DSTB_CTR_BAL_ON_HND_QT_LY_FSC)/ NULLIF(COUNT(LY_DT_SK),0)) AS [AVG_DSTB_CTR_BAL_ON_HND_QT_LY_FSC],
				(SUM(Inv.RTL_SVC_CTR_BAL_ON_HND_QT_TY_FSC)/ NULLIF(COUNT(DT_SK),0)) AS [AVG_RTL_SVC_CTR_BAL_ON_HND_QT_TY_FSC],
				(SUM(Inv.RTL_SVC_CTR_BAL_ON_HND_QT_LY_FSC)/ NULLIF(COUNT(LY_DT_SK),0)) AS [AVG_RTL_SVC_CTR_BAL_ON_HND_QT_LY_FSC],
				(SUM(Inv.DSTB_CTR_CST_AM_TY_FSC)/ NULLIF(COUNT(DT_SK),0)) AS [AVG_DSTB_CTR_CST_AM_TY_FSC],
				(SUM(Inv.DSTB_CTR_CST_AM_LY_FSC)/ NULLIF(COUNT(LY_DT_SK),0)) AS [AVG_DSTB_CTR_CST_AM_LY_FSC],
				(SUM(Inv.DSTB_CTR_FNC_CHRG_AM_LY_HLDY)/ NULLIF(COUNT(LY_DT_SK_HLDY),0)) AS [AVG_DSTB_CTR_FNC_CHRG_AM_LY_HLDY],
				(SUM(Inv.DSTB_CTR_FNC_CR_AM_LY_HLDY)/ NULLIF(COUNT(LY_DT_SK_HLDY),0)) AS [AVG_DSTB_CTR_FNC_CR_AM_LY_HLDY],
				(SUM(Inv.DSTB_CTR_STG_CHRG_AM_LY_HLDY)/ NULLIF(COUNT(LY_DT_SK_HLDY),0)) AS [AVG_DSTB_CTR_STG_CHRG_AM_LY_HLDY],
				(SUM(Inv.EST_DLVY_CST_AM_LY_HLDY)/ NULLIF(COUNT(LY_DT_SK_HLDY),0)) AS [AVG_EST_DLVY_CST_AM_LY_HLDY],
				(SUM(Inv.TRNSF_QT_LY_HLDY)/ NULLIF(COUNT(LY_DT_SK_HLDY),0)) AS [AVG_TRNSF_QT_LY_HLDY],
				(SUM(Inv.WK_OUT_OF_STK_QT_LY_HLDY)/ NULLIF(COUNT(LY_DT_SK_HLDY),0)) AS [AVG_WK_OUT_OF_STK_QT_LY_HLDY],
				(SUM(Inv.WK_OUT_OF_STK_SBS_QT_LY_HLDY)/ NULLIF(COUNT(LY_DT_SK_HLDY),0)) AS [AVG_WK_OUT_OF_STK_SBS_QT_LY_HLDY],
				(SUM(Inv.WK_OVRD_SBS_QT_LY_HLDY)/ NULLIF(COUNT(LY_DT_SK_HLDY),0)) AS [AVG_WK_OVRD_SBS_QT_LY_HLDY],
				(SUM(Inv.WK_ADJ_QT_LY_HLDY)/ NULLIF(COUNT(LY_DT_SK_HLDY),0)) AS [AVG_WK_ADJ_QT_LY_HLDY],
				(SUM(Inv.WK_DSTB_CTR_MVMT_QT_LY_HLDY)/ NULLIF(COUNT(LY_DT_SK_HLDY),0)) AS [AVG_WK_DSTB_CTR_MVMT_QT_LY_HLDY],
				(SUM(Inv.WK_MVMT_CST_AM_LY_HLDY)/ NULLIF(COUNT(LY_DT_SK_HLDY),0)) AS [AVG_WK_MVMT_CST_AM_LY_HLDY],
				(SUM(Inv.WK_MVMT_RTL_AM_LY_HLDY)/ NULLIF(COUNT(LY_DT_SK_HLDY),0)) AS [AVG_WK_MVMT_RTL_AM_LY_HLDY],
				(SUM(Inv.WK_RCV_QT_LY_HLDY)/ NULLIF(COUNT(LY_DT_SK_HLDY),0)) AS [AVG_WK_RCV_QT_LY_HLDY],
				(SUM(Inv.DSTB_CTR_BAL_ON_HND_QT_LY_HLDY)/ NULLIF(COUNT(LY_DT_SK_HLDY),0)) AS [AVG_DSTB_CTR_BAL_ON_HND_QT_LY_HLDY],
				(SUM(Inv.RTL_SVC_CTR_BAL_ON_HND_QT_LY_HLDY)/ NULLIF(COUNT(LY_DT_SK_HLDY),0)) AS [AVG_RTL_SVC_CTR_BAL_ON_HND_QT_LY_HLDY],
				(SUM(Inv.DSTB_CTR_CST_AM_LY_HLDY)/ NULLIF(COUNT(LY_DT_SK_HLDY),0)) AS [AVG_DSTB_CTR_CST_AM_LY_HLDY],
				(SUM(Inv.DSTB_CTR_FNC_CHRG_AM_LY_CAL)/ NULLIF(COUNT(LY_DT_SK_CAL),0)) AS [AVG_DSTB_CTR_FNC_CHRG_AM_LY_CAL],
				(SUM(Inv.DSTB_CTR_FNC_CR_AM_LY_CAL)/ NULLIF(COUNT(LY_DT_SK_CAL),0)) AS [AVG_DSTB_CTR_FNC_CR_AM_LY_CAL],
				(SUM(Inv.DSTB_CTR_STG_CHRG_AM_LY_CAL)/ NULLIF(COUNT(LY_DT_SK_CAL),0)) AS [AVG_DSTB_CTR_STG_CHRG_AM_LY_CAL],
				(SUM(Inv.EST_DLVY_CST_AM_LY_CAL)/ NULLIF(COUNT(LY_DT_SK_CAL),0)) AS [AVG_EST_DLVY_CST_AM_LY_CAL],
				(SUM(Inv.TRNSF_QT_LY_CAL)/ NULLIF(COUNT(LY_DT_SK_CAL),0)) AS [AVG_TRNSF_QT_LY_CAL],
				(SUM(Inv.WK_OUT_OF_STK_QT_LY_CAL)/ NULLIF(COUNT(LY_DT_SK_CAL),0)) AS [AVG_WK_OUT_OF_STK_QT_LY_CAL],
				(SUM(Inv.WK_OUT_OF_STK_SBS_QT_LY_CAL)/ NULLIF(COUNT(LY_DT_SK_CAL),0)) AS [AVG_WK_OUT_OF_STK_SBS_QT_LY_CAL],
				(SUM(Inv.WK_OVRD_SBS_QT_LY_CAL)/ NULLIF(COUNT(LY_DT_SK_CAL),0)) AS [AVG_WK_OVRD_SBS_QT_LY_CAL],
				(SUM(Inv.WK_ADJ_QT_LY_CAL)/ NULLIF(COUNT(LY_DT_SK_CAL),0)) AS [AVG_WK_ADJ_QT_LY_CAL],
				(SUM(Inv.WK_DSTB_CTR_MVMT_QT_LY_CAL)/ NULLIF(COUNT(LY_DT_SK_CAL),0)) AS [AVG_WK_DSTB_CTR_MVMT_QT_LY_CAL],
				(SUM(Inv.WK_MVMT_CST_AM_LY_CAL)/ NULLIF(COUNT(LY_DT_SK_CAL),0)) AS [AVG_WK_MVMT_CST_AM_LY_CAL],
				(SUM(Inv.WK_MVMT_RTL_AM_LY_CAL)/ NULLIF(COUNT(LY_DT_SK_CAL),0)) AS [AVG_WK_MVMT_RTL_AM_LY_CAL],
				(SUM(Inv.WK_RCV_QT_LY_CAL)/ NULLIF(COUNT(LY_DT_SK_CAL),0)) AS [AVG_WK_RCV_QT_LY_CAL],
				(SUM(Inv.DSTB_CTR_BAL_ON_HND_QT_LY_CAL)/ NULLIF(COUNT(LY_DT_SK_CAL),0)) AS [AVG_DSTB_CTR_BAL_ON_HND_QT_LY_CAL],
				(SUM(Inv.RTL_SVC_CTR_BAL_ON_HND_QT_LY_CAL)/ NULLIF(COUNT(LY_DT_SK_CAL),0)) AS [AVG_RTL_SVC_CTR_BAL_ON_HND_QT_LY_CAL],
				(SUM(Inv.DSTB_CTR_CST_AM_LY_CAL)/ NULLIF(COUNT(LY_DT_SK_CAL),0)) AS [AVG_DSTB_CTR_CST_AM_LY_CAL]

				FROM EDAA_PRES.[FCT_DSTB_CTR_INV_QTY_TY_LY_FSC] as Inv
				inner join EDAA_PRES.V_DIM_PRE_DEF_CAL_TYP as CalTyp
					ON  Inv.DT_SK >= CalTyp.MIN_DT
					AND Inv.DT_SK <= CalTyp.MAX_DT
					AND Inv.DT_SK <= FORMAT(GETDATE(),'yyyyMMdd')
					AND CalTyp.PRE_DEF_NM = 'PTD'
					--AND Inv.LY_DT_SK_HLDY <= CalTyp.MAX_DT
					AND CalTyp.AGG_TYP = 'AGG'
					GROUP BY
					STR_ID,
				    P_ID,
				    PRE_DEF_ID

	UNION

           SELECT
				STR_ID,
				P_ID,
				PRE_DEF_ID,
				(SUM(Inv.DSTB_CTR_FNC_CHRG_AM_TY_FSC)/ NULLIF(COUNT(DT_SK),0)) AS [AVG_DSTB_CTR_FNC_CHRG_AM_TY_FSC],
				(SUM(Inv.DSTB_CTR_FNC_CHRG_AM_LY_FSC)/ NULLIF(COUNT(LY_DT_SK),0)) AS [AVG_DSTB_CTR_FNC_CHRG_AM_LY_FSC],
				(SUM(Inv.DSTB_CTR_FNC_CR_AM_TY_FSC) / NULLIF(COUNT(DT_SK),0)) AS [AVG_DSTB_CTR_FNC_CR_AM_TY_FSC],
				(SUM(Inv.DSTB_CTR_FNC_CR_AM_LY_FSC)/ NULLIF(COUNT(LY_DT_SK),0)) AS [AVG_DSTB_CTR_FNC_CR_AM_LY_FSC],
				(SUM(Inv.DSTB_CTR_STG_CHRG_AM_TY_FSC)/ NULLIF(COUNT(DT_SK),0)) AS [AVG_DSTB_CTR_STG_CHRG_AM_TY_FSC],
				(SUM(Inv.DSTB_CTR_STG_CHRG_AM_LY_FSC)/ NULLIF(COUNT(LY_DT_SK),0)) AS [AVG_DSTB_CTR_STG_CHRG_AM_LY_FSC],
				(SUM(Inv.EST_DLVY_CST_AM_TY_FSC)/ NULLIF(COUNT(DT_SK),0)) AS [AVG_EST_DLVY_CST_AM_TY_FSC],
				(SUM(Inv.EST_DLVY_CST_AM_LY_FSC)/ NULLIF(COUNT(LY_DT_SK),0)) AS [AVG_EST_DLVY_CST_AM_LY_FSC],
				(SUM(Inv.TRNSF_QT_TY_FSC)/ NULLIF(COUNT(DT_SK),0)) AS [AVG_TRNSF_QT_TY_FSC],
				(SUM(Inv.TRNSF_QT_LY_FSC)/ NULLIF(COUNT(LY_DT_SK),0)) AS [AVG_TRNSF_QT_LY_FSC],
				(SUM(Inv.WK_OUT_OF_STK_QT_TY_FSC)/ NULLIF(COUNT(DT_SK),0)) AS [AVG_WK_OUT_OF_STK_QT_TY_FSC],
				(SUM(Inv.WK_OUT_OF_STK_QT_LY_FSC)/ NULLIF(COUNT(LY_DT_SK),0)) AS [AVG_WK_OUT_OF_STK_QT_LY_FSC],
				(SUM(Inv.WK_OUT_OF_STK_SBS_QT_TY_FSC)/ NULLIF(COUNT(DT_SK),0)) AS [AVG_WK_OUT_OF_STK_SBS_QT_TY_FSC],
				(SUM(Inv.WK_OUT_OF_STK_SBS_QT_LY_FSC)/ NULLIF(COUNT(LY_DT_SK),0)) AS [AVG_WK_OUT_OF_STK_SBS_QT_LY_FSC],
				(SUM(Inv.WK_OVRD_SBS_QT_TY_FSC)/ NULLIF(COUNT(DT_SK),0)) AS [AVG_WK_OVRD_SBS_QT_TY_FSC],
				(SUM(Inv.WK_OVRD_SBS_QT_LY_FSC)/ NULLIF(COUNT(LY_DT_SK),0)) AS [AVG_WK_OVRD_SBS_QT_LY_FSC],
				(SUM(Inv.WK_ADJ_QT_TY_FSC)/ NULLIF(COUNT(DT_SK),0)) AS [AVG_WK_ADJ_QT_TY_FSC],
				(SUM(Inv.WK_ADJ_QT_LY_FSC)/ NULLIF(COUNT(LY_DT_SK),0)) AS [AVG_WK_ADJ_QT_LY_FSC],
				(SUM(Inv.WK_DSTB_CTR_MVMT_QT_TY_FSC)/ NULLIF(COUNT(DT_SK),0)) AS [AVG_WK_DSTB_CTR_MVMT_QT_TY_FSC],
				(SUM(Inv.WK_DSTB_CTR_MVMT_QT_LY_FSC)/ NULLIF(COUNT(LY_DT_SK),0)) AS [AVG_WK_DSTB_CTR_MVMT_QT_LY_FSC],
				(SUM(Inv.WK_MVMT_CST_AM_TY_FSC)/ NULLIF(COUNT(DT_SK),0)) AS [AVG_WK_MVMT_CST_AM_TY_FSC],
				(SUM(Inv.WK_MVMT_CST_AM_LY_FSC)/ NULLIF(COUNT(LY_DT_SK),0)) AS [AVG_WK_MVMT_CST_AM_LY_FSC],
				(SUM(Inv.WK_MVMT_RTL_AM_TY_FSC)/ NULLIF(COUNT(DT_SK),0)) AS [AVG_WK_MVMT_RTL_AM_TY_FSC],
				(SUM(Inv.WK_MVMT_RTL_AM_LY_FSC)/ NULLIF(COUNT(LY_DT_SK),0)) AS [AVG_WK_MVMT_RTL_AM_LY_FSC],
				(SUM(Inv.WK_RCV_QT_TY_FSC)/ NULLIF(COUNT(DT_SK),0)) AS [AVG_WK_RCV_QT_TY_FSC],
				(SUM(Inv.WK_RCV_QT_LY_FSC)/ NULLIF(COUNT(LY_DT_SK),0)) AS [AVG_WK_RCV_QT_LY_FSC],
				(SUM(Inv.DSTB_CTR_BAL_ON_HND_QT_TY_FSC)/ NULLIF(COUNT(DT_SK),0)) AS [AVG_DSTB_CTR_BAL_ON_HND_QT_TY_FSC],
				(SUM(Inv.DSTB_CTR_BAL_ON_HND_QT_LY_FSC)/ NULLIF(COUNT(LY_DT_SK),0)) AS [AVG_DSTB_CTR_BAL_ON_HND_QT_LY_FSC],
				(SUM(Inv.RTL_SVC_CTR_BAL_ON_HND_QT_TY_FSC)/ NULLIF(COUNT(DT_SK),0)) AS [AVG_RTL_SVC_CTR_BAL_ON_HND_QT_TY_FSC],
				(SUM(Inv.RTL_SVC_CTR_BAL_ON_HND_QT_LY_FSC)/ NULLIF(COUNT(LY_DT_SK),0)) AS [AVG_RTL_SVC_CTR_BAL_ON_HND_QT_LY_FSC],
				(SUM(Inv.DSTB_CTR_CST_AM_TY_FSC)/ NULLIF(COUNT(DT_SK),0)) AS [AVG_DSTB_CTR_CST_AM_TY_FSC],
				(SUM(Inv.DSTB_CTR_CST_AM_LY_FSC)/ NULLIF(COUNT(LY_DT_SK),0)) AS [AVG_DSTB_CTR_CST_AM_LY_FSC],
				(SUM(Inv.DSTB_CTR_FNC_CHRG_AM_LY_HLDY)/ NULLIF(COUNT(LY_DT_SK_HLDY),0)) AS [AVG_DSTB_CTR_FNC_CHRG_AM_LY_HLDY],
				(SUM(Inv.DSTB_CTR_FNC_CR_AM_LY_HLDY)/ NULLIF(COUNT(LY_DT_SK_HLDY),0)) AS [AVG_DSTB_CTR_FNC_CR_AM_LY_HLDY],
				(SUM(Inv.DSTB_CTR_STG_CHRG_AM_LY_HLDY)/ NULLIF(COUNT(LY_DT_SK_HLDY),0)) AS [AVG_DSTB_CTR_STG_CHRG_AM_LY_HLDY],
				(SUM(Inv.EST_DLVY_CST_AM_LY_HLDY)/ NULLIF(COUNT(LY_DT_SK_HLDY),0)) AS [AVG_EST_DLVY_CST_AM_LY_HLDY],
				(SUM(Inv.TRNSF_QT_LY_HLDY)/ NULLIF(COUNT(LY_DT_SK_HLDY),0)) AS [AVG_TRNSF_QT_LY_HLDY],
				(SUM(Inv.WK_OUT_OF_STK_QT_LY_HLDY)/ NULLIF(COUNT(LY_DT_SK_HLDY),0)) AS [AVG_WK_OUT_OF_STK_QT_LY_HLDY],
				(SUM(Inv.WK_OUT_OF_STK_SBS_QT_LY_HLDY)/ NULLIF(COUNT(LY_DT_SK_HLDY),0)) AS [AVG_WK_OUT_OF_STK_SBS_QT_LY_HLDY],
				(SUM(Inv.WK_OVRD_SBS_QT_LY_HLDY)/ NULLIF(COUNT(LY_DT_SK_HLDY),0)) AS [AVG_WK_OVRD_SBS_QT_LY_HLDY],
				(SUM(Inv.WK_ADJ_QT_LY_HLDY)/ NULLIF(COUNT(LY_DT_SK_HLDY),0)) AS [AVG_WK_ADJ_QT_LY_HLDY],
				(SUM(Inv.WK_DSTB_CTR_MVMT_QT_LY_HLDY)/ NULLIF(COUNT(LY_DT_SK_HLDY),0)) AS [AVG_WK_DSTB_CTR_MVMT_QT_LY_HLDY],
				(SUM(Inv.WK_MVMT_CST_AM_LY_HLDY)/ NULLIF(COUNT(LY_DT_SK_HLDY),0)) AS [AVG_WK_MVMT_CST_AM_LY_HLDY],
				(SUM(Inv.WK_MVMT_RTL_AM_LY_HLDY)/ NULLIF(COUNT(LY_DT_SK_HLDY),0)) AS [AVG_WK_MVMT_RTL_AM_LY_HLDY],
				(SUM(Inv.WK_RCV_QT_LY_HLDY)/ NULLIF(COUNT(LY_DT_SK_HLDY),0)) AS [AVG_WK_RCV_QT_LY_HLDY],
				(SUM(Inv.DSTB_CTR_BAL_ON_HND_QT_LY_HLDY)/ NULLIF(COUNT(LY_DT_SK_HLDY),0)) AS [AVG_DSTB_CTR_BAL_ON_HND_QT_LY_HLDY],
				(SUM(Inv.RTL_SVC_CTR_BAL_ON_HND_QT_LY_HLDY)/ NULLIF(COUNT(LY_DT_SK_HLDY),0)) AS [AVG_RTL_SVC_CTR_BAL_ON_HND_QT_LY_HLDY],
				(SUM(Inv.DSTB_CTR_CST_AM_LY_HLDY)/ NULLIF(COUNT(LY_DT_SK_HLDY),0)) AS [AVG_DSTB_CTR_CST_AM_LY_HLDY],
				(SUM(Inv.DSTB_CTR_FNC_CHRG_AM_LY_CAL)/ NULLIF(COUNT(LY_DT_SK_CAL),0)) AS [AVG_DSTB_CTR_FNC_CHRG_AM_LY_CAL],
				(SUM(Inv.DSTB_CTR_FNC_CR_AM_LY_CAL)/ NULLIF(COUNT(LY_DT_SK_CAL),0)) AS [AVG_DSTB_CTR_FNC_CR_AM_LY_CAL],
				(SUM(Inv.DSTB_CTR_STG_CHRG_AM_LY_CAL)/ NULLIF(COUNT(LY_DT_SK_CAL),0)) AS [AVG_DSTB_CTR_STG_CHRG_AM_LY_CAL],
				(SUM(Inv.EST_DLVY_CST_AM_LY_CAL)/ NULLIF(COUNT(LY_DT_SK_CAL),0)) AS [AVG_EST_DLVY_CST_AM_LY_CAL],
				(SUM(Inv.TRNSF_QT_LY_CAL)/ NULLIF(COUNT(LY_DT_SK_CAL),0)) AS [AVG_TRNSF_QT_LY_CAL],
				(SUM(Inv.WK_OUT_OF_STK_QT_LY_CAL)/ NULLIF(COUNT(LY_DT_SK_CAL),0)) AS [AVG_WK_OUT_OF_STK_QT_LY_CAL],
				(SUM(Inv.WK_OUT_OF_STK_SBS_QT_LY_CAL)/ NULLIF(COUNT(LY_DT_SK_CAL),0)) AS [AVG_WK_OUT_OF_STK_SBS_QT_LY_CAL],
				(SUM(Inv.WK_OVRD_SBS_QT_LY_CAL)/ NULLIF(COUNT(LY_DT_SK_CAL),0)) AS [AVG_WK_OVRD_SBS_QT_LY_CAL],
				(SUM(Inv.WK_ADJ_QT_LY_CAL)/ NULLIF(COUNT(LY_DT_SK_CAL),0)) AS [AVG_WK_ADJ_QT_LY_CAL],
				(SUM(Inv.WK_DSTB_CTR_MVMT_QT_LY_CAL)/ NULLIF(COUNT(LY_DT_SK_CAL),0)) AS [AVG_WK_DSTB_CTR_MVMT_QT_LY_CAL],
				(SUM(Inv.WK_MVMT_CST_AM_LY_CAL)/ NULLIF(COUNT(LY_DT_SK_CAL),0)) AS [AVG_WK_MVMT_CST_AM_LY_CAL],
				(SUM(Inv.WK_MVMT_RTL_AM_LY_CAL)/ NULLIF(COUNT(LY_DT_SK_CAL),0)) AS [AVG_WK_MVMT_RTL_AM_LY_CAL],
				(SUM(Inv.WK_RCV_QT_LY_CAL)/ NULLIF(COUNT(LY_DT_SK_CAL),0)) AS [AVG_WK_RCV_QT_LY_CAL],
				(SUM(Inv.DSTB_CTR_BAL_ON_HND_QT_LY_CAL)/ NULLIF(COUNT(LY_DT_SK_CAL),0)) AS [AVG_DSTB_CTR_BAL_ON_HND_QT_LY_CAL],
				(SUM(Inv.RTL_SVC_CTR_BAL_ON_HND_QT_LY_CAL)/ NULLIF(COUNT(LY_DT_SK_CAL),0)) AS [AVG_RTL_SVC_CTR_BAL_ON_HND_QT_LY_CAL],
				(SUM(Inv.DSTB_CTR_CST_AM_LY_CAL)/ NULLIF(COUNT(LY_DT_SK_CAL),0)) AS [AVG_DSTB_CTR_CST_AM_LY_CAL]

				FROM EDAA_PRES.[FCT_DSTB_CTR_INV_QTY_TY_LY_FSC] as Inv
				inner join EDAA_PRES.V_DIM_PRE_DEF_CAL_TYP as CalTyp
					ON  Inv.DT_SK >= CalTyp.MIN_DT
					AND Inv.DT_SK <= CalTyp.MAX_DT
					AND Inv.DT_SK <= FORMAT(GETDATE(),'yyyyMMdd')
					AND CalTyp.PRE_DEF_NM = 'WktoDT'
					--AND Inv.LY_DT_SK_HLDY <= CalTyp.MAX_DT
					AND CalTyp.AGG_TYP = 'AGG'
					GROUP BY
					STR_ID,
				    P_ID,
				    PRE_DEF_ID

 UNION
              SELECT
				STR_ID,
				P_ID,
				PRE_DEF_ID,
				(SUM(Inv.DSTB_CTR_FNC_CHRG_AM_TY_FSC)/ NULLIF(COUNT(DT_SK),0)) AS [AVG_DSTB_CTR_FNC_CHRG_AM_TY_FSC],
				(SUM(Inv.DSTB_CTR_FNC_CHRG_AM_LY_FSC)/ NULLIF(COUNT(LY_DT_SK),0)) AS [AVG_DSTB_CTR_FNC_CHRG_AM_LY_FSC],
				(SUM(Inv.DSTB_CTR_FNC_CR_AM_TY_FSC) / NULLIF(COUNT(DT_SK),0)) AS [AVG_DSTB_CTR_FNC_CR_AM_TY_FSC],
				(SUM(Inv.DSTB_CTR_FNC_CR_AM_LY_FSC)/ NULLIF(COUNT(LY_DT_SK),0)) AS [AVG_DSTB_CTR_FNC_CR_AM_LY_FSC],
				(SUM(Inv.DSTB_CTR_STG_CHRG_AM_TY_FSC)/ NULLIF(COUNT(DT_SK),0)) AS [AVG_DSTB_CTR_STG_CHRG_AM_TY_FSC],
				(SUM(Inv.DSTB_CTR_STG_CHRG_AM_LY_FSC)/ NULLIF(COUNT(LY_DT_SK),0)) AS [AVG_DSTB_CTR_STG_CHRG_AM_LY_FSC],
				(SUM(Inv.EST_DLVY_CST_AM_TY_FSC)/ NULLIF(COUNT(DT_SK),0)) AS [AVG_EST_DLVY_CST_AM_TY_FSC],
				(SUM(Inv.EST_DLVY_CST_AM_LY_FSC)/ NULLIF(COUNT(LY_DT_SK),0)) AS [AVG_EST_DLVY_CST_AM_LY_FSC],
				(SUM(Inv.TRNSF_QT_TY_FSC)/ NULLIF(COUNT(DT_SK),0)) AS [AVG_TRNSF_QT_TY_FSC],
				(SUM(Inv.TRNSF_QT_LY_FSC)/ NULLIF(COUNT(LY_DT_SK),0)) AS [AVG_TRNSF_QT_LY_FSC],
				(SUM(Inv.WK_OUT_OF_STK_QT_TY_FSC)/ NULLIF(COUNT(DT_SK),0)) AS [AVG_WK_OUT_OF_STK_QT_TY_FSC],
				(SUM(Inv.WK_OUT_OF_STK_QT_LY_FSC)/ NULLIF(COUNT(LY_DT_SK),0)) AS [AVG_WK_OUT_OF_STK_QT_LY_FSC],
				(SUM(Inv.WK_OUT_OF_STK_SBS_QT_TY_FSC)/ NULLIF(COUNT(DT_SK),0)) AS [AVG_WK_OUT_OF_STK_SBS_QT_TY_FSC],
				(SUM(Inv.WK_OUT_OF_STK_SBS_QT_LY_FSC)/ NULLIF(COUNT(LY_DT_SK),0)) AS [AVG_WK_OUT_OF_STK_SBS_QT_LY_FSC],
				(SUM(Inv.WK_OVRD_SBS_QT_TY_FSC)/ NULLIF(COUNT(DT_SK),0)) AS [AVG_WK_OVRD_SBS_QT_TY_FSC],
				(SUM(Inv.WK_OVRD_SBS_QT_LY_FSC)/ NULLIF(COUNT(LY_DT_SK),0)) AS [AVG_WK_OVRD_SBS_QT_LY_FSC],
				(SUM(Inv.WK_ADJ_QT_TY_FSC)/ NULLIF(COUNT(DT_SK),0)) AS [AVG_WK_ADJ_QT_TY_FSC],
				(SUM(Inv.WK_ADJ_QT_LY_FSC)/ NULLIF(COUNT(LY_DT_SK),0)) AS [AVG_WK_ADJ_QT_LY_FSC],
				(SUM(Inv.WK_DSTB_CTR_MVMT_QT_TY_FSC)/ NULLIF(COUNT(DT_SK),0)) AS [AVG_WK_DSTB_CTR_MVMT_QT_TY_FSC],
				(SUM(Inv.WK_DSTB_CTR_MVMT_QT_LY_FSC)/ NULLIF(COUNT(LY_DT_SK),0)) AS [AVG_WK_DSTB_CTR_MVMT_QT_LY_FSC],
				(SUM(Inv.WK_MVMT_CST_AM_TY_FSC)/ NULLIF(COUNT(DT_SK),0)) AS [AVG_WK_MVMT_CST_AM_TY_FSC],
				(SUM(Inv.WK_MVMT_CST_AM_LY_FSC)/ NULLIF(COUNT(LY_DT_SK),0)) AS [AVG_WK_MVMT_CST_AM_LY_FSC],
				(SUM(Inv.WK_MVMT_RTL_AM_TY_FSC)/ NULLIF(COUNT(DT_SK),0)) AS [AVG_WK_MVMT_RTL_AM_TY_FSC],
				(SUM(Inv.WK_MVMT_RTL_AM_LY_FSC)/ NULLIF(COUNT(LY_DT_SK),0)) AS [AVG_WK_MVMT_RTL_AM_LY_FSC],
				(SUM(Inv.WK_RCV_QT_TY_FSC)/ NULLIF(COUNT(DT_SK),0)) AS [AVG_WK_RCV_QT_TY_FSC],
				(SUM(Inv.WK_RCV_QT_LY_FSC)/ NULLIF(COUNT(LY_DT_SK),0)) AS [AVG_WK_RCV_QT_LY_FSC],
				(SUM(Inv.DSTB_CTR_BAL_ON_HND_QT_TY_FSC)/ NULLIF(COUNT(DT_SK),0)) AS [AVG_DSTB_CTR_BAL_ON_HND_QT_TY_FSC],
				(SUM(Inv.DSTB_CTR_BAL_ON_HND_QT_LY_FSC)/ NULLIF(COUNT(LY_DT_SK),0)) AS [AVG_DSTB_CTR_BAL_ON_HND_QT_LY_FSC],
				(SUM(Inv.RTL_SVC_CTR_BAL_ON_HND_QT_TY_FSC)/ NULLIF(COUNT(DT_SK),0)) AS [AVG_RTL_SVC_CTR_BAL_ON_HND_QT_TY_FSC],
				(SUM(Inv.RTL_SVC_CTR_BAL_ON_HND_QT_LY_FSC)/ NULLIF(COUNT(LY_DT_SK),0)) AS [AVG_RTL_SVC_CTR_BAL_ON_HND_QT_LY_FSC],
				(SUM(Inv.DSTB_CTR_CST_AM_TY_FSC)/ NULLIF(COUNT(DT_SK),0)) AS [AVG_DSTB_CTR_CST_AM_TY_FSC],
				(SUM(Inv.DSTB_CTR_CST_AM_LY_FSC)/ NULLIF(COUNT(LY_DT_SK),0)) AS [AVG_DSTB_CTR_CST_AM_LY_FSC],
				(SUM(Inv.DSTB_CTR_FNC_CHRG_AM_LY_HLDY)/ NULLIF(COUNT(LY_DT_SK_HLDY),0)) AS [AVG_DSTB_CTR_FNC_CHRG_AM_LY_HLDY],
				(SUM(Inv.DSTB_CTR_FNC_CR_AM_LY_HLDY)/ NULLIF(COUNT(LY_DT_SK_HLDY),0)) AS [AVG_DSTB_CTR_FNC_CR_AM_LY_HLDY],
				(SUM(Inv.DSTB_CTR_STG_CHRG_AM_LY_HLDY)/ NULLIF(COUNT(LY_DT_SK_HLDY),0)) AS [AVG_DSTB_CTR_STG_CHRG_AM_LY_HLDY],
				(SUM(Inv.EST_DLVY_CST_AM_LY_HLDY)/ NULLIF(COUNT(LY_DT_SK_HLDY),0)) AS [AVG_EST_DLVY_CST_AM_LY_HLDY],
				(SUM(Inv.TRNSF_QT_LY_HLDY)/ NULLIF(COUNT(LY_DT_SK_HLDY),0)) AS [AVG_TRNSF_QT_LY_HLDY],
				(SUM(Inv.WK_OUT_OF_STK_QT_LY_HLDY)/ NULLIF(COUNT(LY_DT_SK_HLDY),0)) AS [AVG_WK_OUT_OF_STK_QT_LY_HLDY],
				(SUM(Inv.WK_OUT_OF_STK_SBS_QT_LY_HLDY)/ NULLIF(COUNT(LY_DT_SK_HLDY),0)) AS [AVG_WK_OUT_OF_STK_SBS_QT_LY_HLDY],
				(SUM(Inv.WK_OVRD_SBS_QT_LY_HLDY)/ NULLIF(COUNT(LY_DT_SK_HLDY),0)) AS [AVG_WK_OVRD_SBS_QT_LY_HLDY],
				(SUM(Inv.WK_ADJ_QT_LY_HLDY)/ NULLIF(COUNT(LY_DT_SK_HLDY),0)) AS [AVG_WK_ADJ_QT_LY_HLDY],
				(SUM(Inv.WK_DSTB_CTR_MVMT_QT_LY_HLDY)/ NULLIF(COUNT(LY_DT_SK_HLDY),0)) AS [AVG_WK_DSTB_CTR_MVMT_QT_LY_HLDY],
				(SUM(Inv.WK_MVMT_CST_AM_LY_HLDY)/ NULLIF(COUNT(LY_DT_SK_HLDY),0)) AS [AVG_WK_MVMT_CST_AM_LY_HLDY],
				(SUM(Inv.WK_MVMT_RTL_AM_LY_HLDY)/ NULLIF(COUNT(LY_DT_SK_HLDY),0)) AS [AVG_WK_MVMT_RTL_AM_LY_HLDY],
				(SUM(Inv.WK_RCV_QT_LY_HLDY)/ NULLIF(COUNT(LY_DT_SK_HLDY),0)) AS [AVG_WK_RCV_QT_LY_HLDY],
				(SUM(Inv.DSTB_CTR_BAL_ON_HND_QT_LY_HLDY)/ NULLIF(COUNT(LY_DT_SK_HLDY),0)) AS [AVG_DSTB_CTR_BAL_ON_HND_QT_LY_HLDY],
				(SUM(Inv.RTL_SVC_CTR_BAL_ON_HND_QT_LY_HLDY)/ NULLIF(COUNT(LY_DT_SK_HLDY),0)) AS [AVG_RTL_SVC_CTR_BAL_ON_HND_QT_LY_HLDY],
				(SUM(Inv.DSTB_CTR_CST_AM_LY_HLDY)/ NULLIF(COUNT(LY_DT_SK_HLDY),0)) AS [AVG_DSTB_CTR_CST_AM_LY_HLDY],
				(SUM(Inv.DSTB_CTR_FNC_CHRG_AM_LY_CAL)/ NULLIF(COUNT(LY_DT_SK_CAL),0)) AS [AVG_DSTB_CTR_FNC_CHRG_AM_LY_CAL],
				(SUM(Inv.DSTB_CTR_FNC_CR_AM_LY_CAL)/ NULLIF(COUNT(LY_DT_SK_CAL),0)) AS [AVG_DSTB_CTR_FNC_CR_AM_LY_CAL],
				(SUM(Inv.DSTB_CTR_STG_CHRG_AM_LY_CAL)/ NULLIF(COUNT(LY_DT_SK_CAL),0)) AS [AVG_DSTB_CTR_STG_CHRG_AM_LY_CAL],
				(SUM(Inv.EST_DLVY_CST_AM_LY_CAL)/ NULLIF(COUNT(LY_DT_SK_CAL),0)) AS [AVG_EST_DLVY_CST_AM_LY_CAL],
				(SUM(Inv.TRNSF_QT_LY_CAL)/ NULLIF(COUNT(LY_DT_SK_CAL),0)) AS [AVG_TRNSF_QT_LY_CAL],
				(SUM(Inv.WK_OUT_OF_STK_QT_LY_CAL)/ NULLIF(COUNT(LY_DT_SK_CAL),0)) AS [AVG_WK_OUT_OF_STK_QT_LY_CAL],
				(SUM(Inv.WK_OUT_OF_STK_SBS_QT_LY_CAL)/ NULLIF(COUNT(LY_DT_SK_CAL),0)) AS [AVG_WK_OUT_OF_STK_SBS_QT_LY_CAL],
				(SUM(Inv.WK_OVRD_SBS_QT_LY_CAL)/ NULLIF(COUNT(LY_DT_SK_CAL),0)) AS [AVG_WK_OVRD_SBS_QT_LY_CAL],
				(SUM(Inv.WK_ADJ_QT_LY_CAL)/ NULLIF(COUNT(LY_DT_SK_CAL),0)) AS [AVG_WK_ADJ_QT_LY_CAL],
				(SUM(Inv.WK_DSTB_CTR_MVMT_QT_LY_CAL)/ NULLIF(COUNT(LY_DT_SK_CAL),0)) AS [AVG_WK_DSTB_CTR_MVMT_QT_LY_CAL],
				(SUM(Inv.WK_MVMT_CST_AM_LY_CAL)/ NULLIF(COUNT(LY_DT_SK_CAL),0)) AS [AVG_WK_MVMT_CST_AM_LY_CAL],
				(SUM(Inv.WK_MVMT_RTL_AM_LY_CAL)/ NULLIF(COUNT(LY_DT_SK_CAL),0)) AS [AVG_WK_MVMT_RTL_AM_LY_CAL],
				(SUM(Inv.WK_RCV_QT_LY_CAL)/ NULLIF(COUNT(LY_DT_SK_CAL),0)) AS [AVG_WK_RCV_QT_LY_CAL],
				(SUM(Inv.DSTB_CTR_BAL_ON_HND_QT_LY_CAL)/ NULLIF(COUNT(LY_DT_SK_CAL),0)) AS [AVG_DSTB_CTR_BAL_ON_HND_QT_LY_CAL],
				(SUM(Inv.RTL_SVC_CTR_BAL_ON_HND_QT_LY_CAL)/ NULLIF(COUNT(LY_DT_SK_CAL),0)) AS [AVG_RTL_SVC_CTR_BAL_ON_HND_QT_LY_CAL],
				(SUM(Inv.DSTB_CTR_CST_AM_LY_CAL)/ NULLIF(COUNT(LY_DT_SK_CAL),0)) AS [AVG_DSTB_CTR_CST_AM_LY_CAL]

				FROM EDAA_PRES.[FCT_DSTB_CTR_INV_QTY_TY_LY_FSC] as Inv
				inner join EDAA_PRES.V_DIM_PRE_DEF_CAL_TYP as CalTyp
				ON  Inv.DT_SK >= CalTyp.MIN_DT
				AND Inv.DT_SK <= CalTyp.MAX_DT
				--AND Inv.LY_DT_SK_HDLY <= CalTyp.MAX_DT
				AND PRE_DEF_NM = 'Yesterday'
				AND CalTyp.AGG_TYP = 'AGG'
				GROUP BY STR_ID,
				         P_ID,
				         PRE_DEF_ID

	),

    CTE2
		AS (
		     SELECT
				STR_ID,
				P_ID,
				PRE_DEF_ID,
				(SUM(Inv.DSTB_CTR_FNC_CHRG_AM_TY_FSC)) AS [END_DSTB_CTR_FNC_CHRG_AM_TY_FSC],
				(SUM(Inv.DSTB_CTR_FNC_CHRG_AM_LY_FSC)) AS [END_DSTB_CTR_FNC_CHRG_AM_LY_FSC],
				(SUM(Inv.DSTB_CTR_FNC_CR_AM_TY_FSC)) AS [END_DSTB_CTR_FNC_CR_AM_TY_FSC],
				(SUM(Inv.DSTB_CTR_FNC_CR_AM_LY_FSC)) AS [END_DSTB_CTR_FNC_CR_AM_LY_FSC],
				(SUM(Inv.DSTB_CTR_STG_CHRG_AM_TY_FSC)) AS [END_DSTB_CTR_STG_CHRG_AM_TY_FSC],
				(SUM(Inv.DSTB_CTR_STG_CHRG_AM_LY_FSC)) AS [END_DSTB_CTR_STG_CHRG_AM_LY_FSC],
				(SUM(Inv.EST_DLVY_CST_AM_TY_FSC)) AS [END_EST_DLVY_CST_AM_TY_FSC],
				(SUM(Inv.EST_DLVY_CST_AM_LY_FSC)) AS [END_EST_DLVY_CST_AM_LY_FSC],
				(SUM(Inv.TRNSF_QT_TY_FSC)) AS [END_TRNSF_QT_TY_FSC],
				(SUM(Inv.TRNSF_QT_LY_FSC)) AS [END_TRNSF_QT_LY_FSC],
				(SUM(Inv.WK_OUT_OF_STK_QT_TY_FSC)) AS [END_WK_OUT_OF_STK_QT_TY_FSC],
				(SUM(Inv.WK_OUT_OF_STK_QT_LY_FSC)) AS [END_WK_OUT_OF_STK_QT_LY_FSC],
				(SUM(Inv.WK_OUT_OF_STK_SBS_QT_TY_FSC)) AS [END_WK_OUT_OF_STK_SBS_QT_TY_FSC],
				(SUM(Inv.WK_OUT_OF_STK_SBS_QT_LY_FSC)) AS [END_WK_OUT_OF_STK_SBS_QT_LY_FSC],
				(SUM(Inv.WK_OVRD_SBS_QT_TY_FSC)) AS [END_WK_OVRD_SBS_QT_TY_FSC],
				(SUM(Inv.WK_OVRD_SBS_QT_LY_FSC)) AS [END_WK_OVRD_SBS_QT_LY_FSC],
				(SUM(Inv.WK_ADJ_QT_TY_FSC)) AS [END_WK_ADJ_QT_TY_FSC],
				(SUM(Inv.WK_ADJ_QT_LY_FSC)) AS [END_WK_ADJ_QT_LY_FSC],
				(SUM(Inv.WK_DSTB_CTR_MVMT_QT_TY_FSC)) AS [END_WK_DSTB_CTR_MVMT_QT_TY_FSC],
				(SUM(Inv.WK_DSTB_CTR_MVMT_QT_LY_FSC)) AS [END_WK_DSTB_CTR_MVMT_QT_LY_FSC],
				(SUM(Inv.WK_MVMT_CST_AM_TY_FSC)) AS [END_WK_MVMT_CST_AM_TY_FSC],
				(SUM(Inv.WK_MVMT_CST_AM_LY_FSC)) AS [END_WK_MVMT_CST_AM_LY_FSC],
				(SUM(Inv.WK_MVMT_RTL_AM_TY_FSC)) AS [END_WK_MVMT_RTL_AM_TY_FSC],
				(SUM(Inv.WK_MVMT_RTL_AM_LY_FSC)) AS [END_WK_MVMT_RTL_AM_LY_FSC],
				(SUM(Inv.WK_RCV_QT_TY_FSC)) AS [END_WK_RCV_QT_TY_FSC],
				(SUM(Inv.WK_RCV_QT_LY_FSC)) AS [END_WK_RCV_QT_LY_FSC],
				(SUM(Inv.DSTB_CTR_BAL_ON_HND_QT_TY_FSC)) AS [END_DSTB_CTR_BAL_ON_HND_QT_TY_FSC],
				(SUM(Inv.DSTB_CTR_BAL_ON_HND_QT_LY_FSC)) AS [END_DSTB_CTR_BAL_ON_HND_QT_LY_FSC],
				(SUM(Inv.RTL_SVC_CTR_BAL_ON_HND_QT_TY_FSC)) AS [END_RTL_SVC_CTR_BAL_ON_HND_QT_TY_FSC],
				(SUM(Inv.RTL_SVC_CTR_BAL_ON_HND_QT_LY_FSC)) AS [END_RTL_SVC_CTR_BAL_ON_HND_QT_LY_FSC],
				(SUM(Inv.DSTB_CTR_CST_AM_TY_FSC)) AS [END_DSTB_CTR_CST_AM_TY_FSC],
				(SUM(Inv.DSTB_CTR_CST_AM_LY_FSC)) AS [END_DSTB_CTR_CST_AM_LY_FSC],
				(SUM(Inv.DSTB_CTR_FNC_CHRG_AM_LY_HLDY)) AS [END_DSTB_CTR_FNC_CHRG_AM_LY_HLDY],
				(SUM(Inv.DSTB_CTR_FNC_CR_AM_LY_HLDY)) AS [END_DSTB_CTR_FNC_CR_AM_LY_HLDY],
				(SUM(Inv.DSTB_CTR_STG_CHRG_AM_LY_HLDY)) AS [END_DSTB_CTR_STG_CHRG_AM_LY_HLDY],
				(SUM(Inv.EST_DLVY_CST_AM_LY_HLDY)) AS [END_EST_DLVY_CST_AM_LY_HLDY],
				(SUM(Inv.TRNSF_QT_LY_HLDY)) AS [END_TRNSF_QT_LY_HLDY],
				(SUM(Inv.WK_OUT_OF_STK_QT_LY_HLDY)) AS [END_WK_OUT_OF_STK_QT_LY_HLDY],
				(SUM(Inv.WK_OUT_OF_STK_SBS_QT_LY_HLDY)) AS [END_WK_OUT_OF_STK_SBS_QT_LY_HLDY],
				(SUM(Inv.WK_OVRD_SBS_QT_LY_HLDY)) AS [END_WK_OVRD_SBS_QT_LY_HLDY],
				(SUM(Inv.WK_ADJ_QT_LY_HLDY)) AS [END_WK_ADJ_QT_LY_HLDY],
				(SUM(Inv.WK_DSTB_CTR_MVMT_QT_LY_HLDY)) AS [END_WK_DSTB_CTR_MVMT_QT_LY_HLDY],
				(SUM(Inv.WK_MVMT_CST_AM_LY_HLDY)) AS [END_WK_MVMT_CST_AM_LY_HLDY],
				(SUM(Inv.WK_MVMT_RTL_AM_LY_HLDY)) AS [END_WK_MVMT_RTL_AM_LY_HLDY],
				(SUM(Inv.WK_RCV_QT_LY_HLDY)) AS [END_WK_RCV_QT_LY_HLDY],
				(SUM(Inv.DSTB_CTR_BAL_ON_HND_QT_LY_HLDY)) AS [END_DSTB_CTR_BAL_ON_HND_QT_LY_HLDY],
				(SUM(Inv.RTL_SVC_CTR_BAL_ON_HND_QT_LY_HLDY)) AS [END_RTL_SVC_CTR_BAL_ON_HND_QT_LY_HLDY],
				(SUM(Inv.DSTB_CTR_CST_AM_LY_HLDY)) AS [END_DSTB_CTR_CST_AM_LY_HLDY],
				(SUM(Inv.DSTB_CTR_FNC_CHRG_AM_LY_CAL)) AS [END_DSTB_CTR_FNC_CHRG_AM_LY_CAL],
				(SUM(Inv.DSTB_CTR_FNC_CR_AM_LY_CAL)) AS [END_DSTB_CTR_FNC_CR_AM_LY_CAL],
				(SUM(Inv.DSTB_CTR_STG_CHRG_AM_LY_CAL)) AS [END_DSTB_CTR_STG_CHRG_AM_LY_CAL],
				(SUM(Inv.EST_DLVY_CST_AM_LY_CAL)) AS [END_EST_DLVY_CST_AM_LY_CAL],
				(SUM(Inv.TRNSF_QT_LY_CAL)) AS [END_TRNSF_QT_LY_CAL],
				(SUM(Inv.WK_OUT_OF_STK_QT_LY_CAL)) AS [END_WK_OUT_OF_STK_QT_LY_CAL],
				(SUM(Inv.WK_OUT_OF_STK_SBS_QT_LY_CAL)) AS [END_WK_OUT_OF_STK_SBS_QT_LY_CAL],
				(SUM(Inv.WK_OVRD_SBS_QT_LY_CAL)) AS [END_WK_OVRD_SBS_QT_LY_CAL],
				(SUM(Inv.WK_ADJ_QT_LY_CAL)) AS [END_WK_ADJ_QT_LY_CAL],
				(SUM(Inv.WK_DSTB_CTR_MVMT_QT_LY_CAL)) AS [END_WK_DSTB_CTR_MVMT_QT_LY_CAL],
				(SUM(Inv.WK_MVMT_CST_AM_LY_CAL)) AS [END_WK_MVMT_CST_AM_LY_CAL],
				(SUM(Inv.WK_MVMT_RTL_AM_LY_CAL)) AS [END_WK_MVMT_RTL_AM_LY_CAL],
				(SUM(Inv.WK_RCV_QT_LY_CAL)) AS [END_WK_RCV_QT_LY_CAL],
				(SUM(Inv.DSTB_CTR_BAL_ON_HND_QT_LY_CAL)) AS [END_DSTB_CTR_BAL_ON_HND_QT_LY_CAL],
				(SUM(Inv.RTL_SVC_CTR_BAL_ON_HND_QT_LY_CAL)) AS [END_RTL_SVC_CTR_BAL_ON_HND_QT_LY_CAL],
				(SUM(Inv.DSTB_CTR_CST_AM_LY_CAL)) AS [END_DSTB_CTR_CST_AM_LY_CAL]

				FROM  EDAA_PRES.FCT_DSTB_CTR_INV_QTY_TY_LY_FSC as Inv
				inner join EDAA_PRES.V_DIM_PRE_DEF_CAL_TYP as CalTyp
					ON  Inv.DT_SK >= CalTyp.MIN_DT
					AND Inv.DT_SK <= CalTyp.MAX_DT
					AND Inv.DT_SK = @DT_LST_WEEKEND
					AND CalTyp.PRE_DEF_NM = 'Last Week'
					AND CalTyp.AGG_TYP = 'AGG'
					GROUP BY
					STR_ID,
				    P_ID,
				    PRE_DEF_ID

UNION
               SELECT
				STR_ID,
				P_ID,
				PRE_DEF_ID,
				(SUM(Inv.DSTB_CTR_FNC_CHRG_AM_TY_FSC)) AS [END_DSTB_CTR_FNC_CHRG_AM_TY_FSC],
				(SUM(Inv.DSTB_CTR_FNC_CHRG_AM_LY_FSC)) AS [END_DSTB_CTR_FNC_CHRG_AM_LY_FSC],
				(SUM(Inv.DSTB_CTR_FNC_CR_AM_TY_FSC)) AS [END_DSTB_CTR_FNC_CR_AM_TY_FSC],
				(SUM(Inv.DSTB_CTR_FNC_CR_AM_LY_FSC)) AS [END_DSTB_CTR_FNC_CR_AM_LY_FSC],
				(SUM(Inv.DSTB_CTR_STG_CHRG_AM_TY_FSC)) AS [END_DSTB_CTR_STG_CHRG_AM_TY_FSC],
				(SUM(Inv.DSTB_CTR_STG_CHRG_AM_LY_FSC)) AS [END_DSTB_CTR_STG_CHRG_AM_LY_FSC],
				(SUM(Inv.EST_DLVY_CST_AM_TY_FSC)) AS [END_EST_DLVY_CST_AM_TY_FSC],
				(SUM(Inv.EST_DLVY_CST_AM_LY_FSC)) AS [END_EST_DLVY_CST_AM_LY_FSC],
				(SUM(Inv.TRNSF_QT_TY_FSC)) AS [END_TRNSF_QT_TY_FSC],
				(SUM(Inv.TRNSF_QT_LY_FSC)) AS [END_TRNSF_QT_LY_FSC],
				(SUM(Inv.WK_OUT_OF_STK_QT_TY_FSC)) AS [END_WK_OUT_OF_STK_QT_TY_FSC],
				(SUM(Inv.WK_OUT_OF_STK_QT_LY_FSC)) AS [END_WK_OUT_OF_STK_QT_LY_FSC],
				(SUM(Inv.WK_OUT_OF_STK_SBS_QT_TY_FSC)) AS [END_WK_OUT_OF_STK_SBS_QT_TY_FSC],
				(SUM(Inv.WK_OUT_OF_STK_SBS_QT_LY_FSC)) AS [END_WK_OUT_OF_STK_SBS_QT_LY_FSC],
				(SUM(Inv.WK_OVRD_SBS_QT_TY_FSC)) AS [END_WK_OVRD_SBS_QT_TY_FSC],
				(SUM(Inv.WK_OVRD_SBS_QT_LY_FSC)) AS [END_WK_OVRD_SBS_QT_LY_FSC],
				(SUM(Inv.WK_ADJ_QT_TY_FSC)) AS [END_WK_ADJ_QT_TY_FSC],
				(SUM(Inv.WK_ADJ_QT_LY_FSC)) AS [END_WK_ADJ_QT_LY_FSC],
				(SUM(Inv.WK_DSTB_CTR_MVMT_QT_TY_FSC)) AS [END_WK_DSTB_CTR_MVMT_QT_TY_FSC],
				(SUM(Inv.WK_DSTB_CTR_MVMT_QT_LY_FSC)) AS [END_WK_DSTB_CTR_MVMT_QT_LY_FSC],
				(SUM(Inv.WK_MVMT_CST_AM_TY_FSC)) AS [END_WK_MVMT_CST_AM_TY_FSC],
				(SUM(Inv.WK_MVMT_CST_AM_LY_FSC)) AS [END_WK_MVMT_CST_AM_LY_FSC],
				(SUM(Inv.WK_MVMT_RTL_AM_TY_FSC)) AS [END_WK_MVMT_RTL_AM_TY_FSC],
				(SUM(Inv.WK_MVMT_RTL_AM_LY_FSC)) AS [END_WK_MVMT_RTL_AM_LY_FSC],
				(SUM(Inv.WK_RCV_QT_TY_FSC)) AS [END_WK_RCV_QT_TY_FSC],
				(SUM(Inv.WK_RCV_QT_LY_FSC)) AS [END_WK_RCV_QT_LY_FSC],
				(SUM(Inv.DSTB_CTR_BAL_ON_HND_QT_TY_FSC)) AS [END_DSTB_CTR_BAL_ON_HND_QT_TY_FSC],
				(SUM(Inv.DSTB_CTR_BAL_ON_HND_QT_LY_FSC)) AS [END_DSTB_CTR_BAL_ON_HND_QT_LY_FSC],
				(SUM(Inv.RTL_SVC_CTR_BAL_ON_HND_QT_TY_FSC)) AS [END_RTL_SVC_CTR_BAL_ON_HND_QT_TY_FSC],
				(SUM(Inv.RTL_SVC_CTR_BAL_ON_HND_QT_LY_FSC)) AS [END_RTL_SVC_CTR_BAL_ON_HND_QT_LY_FSC],
				(SUM(Inv.DSTB_CTR_CST_AM_TY_FSC)) AS [END_DSTB_CTR_CST_AM_TY_FSC],
				(SUM(Inv.DSTB_CTR_CST_AM_LY_FSC)) AS [END_DSTB_CTR_CST_AM_LY_FSC],
				(SUM(Inv.DSTB_CTR_FNC_CHRG_AM_LY_HLDY)) AS [END_DSTB_CTR_FNC_CHRG_AM_LY_HLDY],
				(SUM(Inv.DSTB_CTR_FNC_CR_AM_LY_HLDY)) AS [END_DSTB_CTR_FNC_CR_AM_LY_HLDY],
				(SUM(Inv.DSTB_CTR_STG_CHRG_AM_LY_HLDY)) AS [END_DSTB_CTR_STG_CHRG_AM_LY_HLDY],
				(SUM(Inv.EST_DLVY_CST_AM_LY_HLDY)) AS [END_EST_DLVY_CST_AM_LY_HLDY],
				(SUM(Inv.TRNSF_QT_LY_HLDY)) AS [END_TRNSF_QT_LY_HLDY],
				(SUM(Inv.WK_OUT_OF_STK_QT_LY_HLDY)) AS [END_WK_OUT_OF_STK_QT_LY_HLDY],
				(SUM(Inv.WK_OUT_OF_STK_SBS_QT_LY_HLDY)) AS [END_WK_OUT_OF_STK_SBS_QT_LY_HLDY],
				(SUM(Inv.WK_OVRD_SBS_QT_LY_HLDY)) AS [END_WK_OVRD_SBS_QT_LY_HLDY],
				(SUM(Inv.WK_ADJ_QT_LY_HLDY)) AS [END_WK_ADJ_QT_LY_HLDY],
				(SUM(Inv.WK_DSTB_CTR_MVMT_QT_LY_HLDY)) AS [END_WK_DSTB_CTR_MVMT_QT_LY_HLDY],
				(SUM(Inv.WK_MVMT_CST_AM_LY_HLDY)) AS [END_WK_MVMT_CST_AM_LY_HLDY],
				(SUM(Inv.WK_MVMT_RTL_AM_LY_HLDY)) AS [END_WK_MVMT_RTL_AM_LY_HLDY],
				(SUM(Inv.WK_RCV_QT_LY_HLDY)) AS [END_WK_RCV_QT_LY_HLDY],
				(SUM(Inv.DSTB_CTR_BAL_ON_HND_QT_LY_HLDY)) AS [END_DSTB_CTR_BAL_ON_HND_QT_LY_HLDY],
				(SUM(Inv.RTL_SVC_CTR_BAL_ON_HND_QT_LY_HLDY)) AS [END_RTL_SVC_CTR_BAL_ON_HND_QT_LY_HLDY],
				(SUM(Inv.DSTB_CTR_CST_AM_LY_HLDY)) AS [END_DSTB_CTR_CST_AM_LY_HLDY],
				(SUM(Inv.DSTB_CTR_FNC_CHRG_AM_LY_CAL)) AS [END_DSTB_CTR_FNC_CHRG_AM_LY_CAL],
				(SUM(Inv.DSTB_CTR_FNC_CR_AM_LY_CAL)) AS [END_DSTB_CTR_FNC_CR_AM_LY_CAL],
				(SUM(Inv.DSTB_CTR_STG_CHRG_AM_LY_CAL)) AS [END_DSTB_CTR_STG_CHRG_AM_LY_CAL],
				(SUM(Inv.EST_DLVY_CST_AM_LY_CAL)) AS [END_EST_DLVY_CST_AM_LY_CAL],
				(SUM(Inv.TRNSF_QT_LY_CAL)) AS [END_TRNSF_QT_LY_CAL],
				(SUM(Inv.WK_OUT_OF_STK_QT_LY_CAL)) AS [END_WK_OUT_OF_STK_QT_LY_CAL],
				(SUM(Inv.WK_OUT_OF_STK_SBS_QT_LY_CAL)) AS [END_WK_OUT_OF_STK_SBS_QT_LY_CAL],
				(SUM(Inv.WK_OVRD_SBS_QT_LY_CAL)) AS [END_WK_OVRD_SBS_QT_LY_CAL],
				(SUM(Inv.WK_ADJ_QT_LY_CAL)) AS [END_WK_ADJ_QT_LY_CAL],
				(SUM(Inv.WK_DSTB_CTR_MVMT_QT_LY_CAL)) AS [END_WK_DSTB_CTR_MVMT_QT_LY_CAL],
				(SUM(Inv.WK_MVMT_CST_AM_LY_CAL)) AS [END_WK_MVMT_CST_AM_LY_CAL],
				(SUM(Inv.WK_MVMT_RTL_AM_LY_CAL)) AS [END_WK_MVMT_RTL_AM_LY_CAL],
				(SUM(Inv.WK_RCV_QT_LY_CAL)) AS [END_WK_RCV_QT_LY_CAL],
				(SUM(Inv.DSTB_CTR_BAL_ON_HND_QT_LY_CAL)) AS [END_DSTB_CTR_BAL_ON_HND_QT_LY_CAL],
				(SUM(Inv.RTL_SVC_CTR_BAL_ON_HND_QT_LY_CAL)) AS [END_RTL_SVC_CTR_BAL_ON_HND_QT_LY_CAL],
				(SUM(Inv.DSTB_CTR_CST_AM_LY_CAL)) AS [END_DSTB_CTR_CST_AM_LY_CAL]

				 FROM EDAA_PRES.FCT_DSTB_CTR_INV_QTY_TY_LY_FSC as Inv
				 inner join EDAA_PRES.V_DIM_PRE_DEF_CAL_TYP as CalTyp
				ON  Inv.DT_SK >= CalTyp.MIN_DT
				AND Inv.DT_SK <= CalTyp.MAX_DT
				AND Inv.DT_SK = FORMAT(GETDATE()-1,'yyyyMMdd')
				AND CalTyp.PRE_DEF_NM IN('FYTD','QTD','PTD','WktoDT')
				--AND Inv.LY_DT_SK_HLDY <= CalTyp.MAX_DT
				AND CalTyp.AGG_TYP = 'AGG'
				GROUP BY STR_ID,
				         P_ID,
				         PRE_DEF_ID



	UNION
				SELECT
				STR_ID,
				P_ID,
				PRE_DEF_ID,
				0 AS [END_DSTB_CTR_FNC_CHRG_AM_TY_FSC],
				0 AS [END_DSTB_CTR_FNC_CHRG_AM_LY_FSC],
				0 AS [END_DSTB_CTR_FNC_CR_AM_TY_FSC],
				0 AS [END_DSTB_CTR_FNC_CR_AM_LY_FSC],
				0 AS [END_DSTB_CTR_STG_CHRG_AM_TY_FSC],
				0 AS [END_DSTB_CTR_STG_CHRG_AM_LY_FSC],
				0 AS [END_EST_DLVY_CST_AM_TY_FSC],
				0 AS [END_EST_DLVY_CST_AM_LY_FSC],
				0 AS [END_TRNSF_QT_TY_FSC],
				0 AS [END_TRNSF_QT_LY_FSC],
				0 AS [END_WK_OUT_OF_STK_QT_TY_FSC],
				0 AS [END_WK_OUT_OF_STK_QT_LY_FSC],
				0 AS [END_WK_OUT_OF_STK_SBS_QT_TY_FSC],
				0 AS [END_WK_OUT_OF_STK_SBS_QT_LY_FSC],
				0 AS [END_WK_OVRD_SBS_QT_TY_FSC],
				0 AS [END_WK_OVRD_SBS_QT_LY_FSC],
				0 AS [END_WK_ADJ_QT_TY_FSC],
				0 AS [END_WK_ADJ_QT_LY_FSC],
				0 AS [END_WK_DSTB_CTR_MVMT_QT_TY_FSC],
				0 AS [END_WK_DSTB_CTR_MVMT_QT_LY_FSC],
				0 AS [END_WK_MVMT_CST_AM_TY_FSC],
				0 AS [END_WK_MVMT_CST_AM_LY_FSC],
				0 AS [END_WK_MVMT_RTL_AM_TY_FSC],
				0 AS [END_WK_MVMT_RTL_AM_LY_FSC],
				0 AS [END_WK_RCV_QT_TY_FSC],
				0 AS [END_WK_RCV_QT_LY_FSC],
				0 AS [END_DSTB_CTR_BAL_ON_HND_QT_TY_FSC],
				0 AS [END_DSTB_CTR_BAL_ON_HND_QT_LY_FSC],
				0 AS [END_RTL_SVC_CTR_BAL_ON_HND_QT_TY_FSC],
				0 AS [END_RTL_SVC_CTR_BAL_ON_HND_QT_LY_FSC],
				0 AS [END_DSTB_CTR_CST_AM_TY_FSC],
				0 AS [END_DSTB_CTR_CST_AM_LY_FSC],
				0 AS [END_DSTB_CTR_FNC_CHRG_AM_LY_HLDY],
				0 AS [END_DSTB_CTR_FNC_CR_AM_LY_HLDY],
				0 AS [END_DSTB_CTR_STG_CHRG_AM_LY_HLDY],
				0 AS [END_EST_DLVY_CST_AM_LY_HLDY],
				0 AS [END_TRNSF_QT_LY_HLDY],
				0 AS [END_WK_OUT_OF_STK_QT_LY_HLDY],
				0 AS [END_WK_OUT_OF_STK_SBS_QT_LY_HLDY],
				0 AS [END_WK_OVRD_SBS_QT_LY_HLDY],
				0 AS [END_WK_ADJ_QT_LY_HLDY],
				0 AS [END_WK_DSTB_CTR_MVMT_QT_LY_HLDY],
				0 AS [END_WK_MVMT_CST_AM_LY_HLDY],
				0 AS [END_WK_MVMT_RTL_AM_LY_HLDY],
				0 AS [AVG_WK_RCV_QT_LY_HLDY],
				0 AS [END_DSTB_CTR_BAL_ON_HND_QT_LY_HLDY],
				0 AS [END_RTL_SVC_CTR_BAL_ON_HND_QT_LY_HLDY],
				0 AS [END_DSTB_CTR_CST_AM_LY_HLDY],
				0 AS [END_DSTB_CTR_FNC_CHRG_AM_LY_CAL],
				0 AS [END_DSTB_CTR_FNC_CR_AM_LY_CAL],
				0 AS [END_DSTB_CTR_STG_CHRG_AM_LY_CAL],
				0 AS [END_EST_DLVY_CST_AM_LY_CAL],
				0 AS [END_TRNSF_QT_LY_CAL],
				0 AS [END_WK_OUT_OF_STK_QT_LY_CAL],
				0 AS [END_WK_OUT_OF_STK_SBS_QT_LY_CAL],
				0 AS [END_WK_OVRD_SBS_QT_LY_CAL],
				0 AS [END_WK_ADJ_QT_LY_CAL],
				0 AS [END_WK_DSTB_CTR_MVMT_QT_LY_CAL],
				0 AS [END_WK_MVMT_CST_AM_LY_CAL],
				0 AS [END_WK_MVMT_RTL_AM_LY_CAL],
				0 AS [END_WK_RCV_QT_LY_CAL],
				0 AS [END_DSTB_CTR_BAL_ON_HND_QT_LY_CAL],
				0 AS [END_RTL_SVC_CTR_BAL_ON_HND_QT_LY_CAL],
				0 AS [END_DSTB_CTR_CST_AM_LY_CAL]

				 FROM EDAA_PRES.FCT_DSTB_CTR_INV_QTY_TY_LY_FSC as Inv
				 inner join EDAA_PRES.V_DIM_PRE_DEF_CAL_TYP as CalTyp
				ON  Inv.DT_SK >= CalTyp.MIN_DT
				AND Inv.DT_SK <= CalTyp.MAX_DT
				AND CalTyp.PRE_DEF_NM = 'Yesterday'
				--AND Inv.LY_DT_SK_HLDY <= CalTyp.MAX_DT
				AND CalTyp.AGG_TYP = 'AGG'
				GROUP BY STR_ID,
				         P_ID,
				         PRE_DEF_ID

		),

MERGE_TABLES AS
(
    Select distinct
	            a.STR_ID,
				a.P_ID,
				a.PRE_DEF_ID,
				a.[AVG_DSTB_CTR_FNC_CHRG_AM_TY_FSC],
				b.[END_DSTB_CTR_FNC_CHRG_AM_TY_FSC],
				a.[AVG_DSTB_CTR_FNC_CHRG_AM_LY_FSC],
				b.[END_DSTB_CTR_FNC_CHRG_AM_LY_FSC],
				a.[AVG_DSTB_CTR_FNC_CR_AM_TY_FSC],
				b.[END_DSTB_CTR_FNC_CR_AM_TY_FSC],
				a.[AVG_DSTB_CTR_FNC_CR_AM_LY_FSC],
				b.[END_DSTB_CTR_FNC_CR_AM_LY_FSC],
				a.[AVG_DSTB_CTR_STG_CHRG_AM_TY_FSC],
				b.[END_DSTB_CTR_STG_CHRG_AM_TY_FSC],
				a.[AVG_DSTB_CTR_STG_CHRG_AM_LY_FSC],
				b.[END_DSTB_CTR_STG_CHRG_AM_LY_FSC],
				a.[AVG_EST_DLVY_CST_AM_TY_FSC],
				b.[END_EST_DLVY_CST_AM_TY_FSC],
				a.[AVG_EST_DLVY_CST_AM_LY_FSC],
				b.[END_EST_DLVY_CST_AM_LY_FSC],
				a.[AVG_TRNSF_QT_TY_FSC],
				b.[END_TRNSF_QT_TY_FSC],
				a.[AVG_TRNSF_QT_LY_FSC],
				b.[END_TRNSF_QT_LY_FSC],
				a.[AVG_WK_OUT_OF_STK_QT_TY_FSC],
				b.[END_WK_OUT_OF_STK_QT_TY_FSC],
				a.[AVG_WK_OUT_OF_STK_QT_LY_FSC],
				b.[END_WK_OUT_OF_STK_QT_LY_FSC],
				a.[AVG_WK_OUT_OF_STK_SBS_QT_TY_FSC],
				b.[END_WK_OUT_OF_STK_SBS_QT_TY_FSC],
				a.[AVG_WK_OUT_OF_STK_SBS_QT_LY_FSC],
				b.[END_WK_OUT_OF_STK_SBS_QT_LY_FSC],
				a.[AVG_WK_OVRD_SBS_QT_TY_FSC],
				b.[END_WK_OVRD_SBS_QT_TY_FSC],
				a.[AVG_WK_OVRD_SBS_QT_LY_FSC],
				b.[END_WK_OVRD_SBS_QT_LY_FSC],
				a.[AVG_WK_ADJ_QT_TY_FSC],
				b.[END_WK_ADJ_QT_TY_FSC],
				a.[AVG_WK_ADJ_QT_LY_FSC],
				b.[END_WK_ADJ_QT_LY_FSC],
				a.[AVG_WK_DSTB_CTR_MVMT_QT_TY_FSC],
				b.[END_WK_DSTB_CTR_MVMT_QT_TY_FSC],
				a.[AVG_WK_DSTB_CTR_MVMT_QT_LY_FSC],
				b.[END_WK_DSTB_CTR_MVMT_QT_LY_FSC],
				a.[AVG_WK_MVMT_CST_AM_TY_FSC],
				b.[END_WK_MVMT_CST_AM_TY_FSC],
				a.[AVG_WK_MVMT_CST_AM_LY_FSC],
				b.[END_WK_MVMT_CST_AM_LY_FSC],
				a.[AVG_WK_MVMT_RTL_AM_TY_FSC],
				b.[END_WK_MVMT_RTL_AM_TY_FSC],
				a.[AVG_WK_MVMT_RTL_AM_LY_FSC],
				b.[END_WK_MVMT_RTL_AM_LY_FSC],
				a.[AVG_WK_RCV_QT_TY_FSC],
				b.[END_WK_RCV_QT_TY_FSC],
				a.[AVG_WK_RCV_QT_LY_FSC],
				b.[END_WK_RCV_QT_LY_FSC],
				a.[AVG_DSTB_CTR_BAL_ON_HND_QT_TY_FSC],
				b.[END_DSTB_CTR_BAL_ON_HND_QT_TY_FSC],
				a.[AVG_DSTB_CTR_BAL_ON_HND_QT_LY_FSC],
				b.[END_DSTB_CTR_BAL_ON_HND_QT_LY_FSC],
				a.[AVG_RTL_SVC_CTR_BAL_ON_HND_QT_TY_FSC],
				b.[END_RTL_SVC_CTR_BAL_ON_HND_QT_TY_FSC],
				a.[AVG_RTL_SVC_CTR_BAL_ON_HND_QT_LY_FSC],
				b.[END_RTL_SVC_CTR_BAL_ON_HND_QT_LY_FSC],
				a.[AVG_DSTB_CTR_CST_AM_TY_FSC],
				b.[END_DSTB_CTR_CST_AM_TY_FSC],
				a.[AVG_DSTB_CTR_CST_AM_LY_FSC],
				b.[END_DSTB_CTR_CST_AM_LY_FSC],
				a.[AVG_DSTB_CTR_FNC_CHRG_AM_LY_HLDY],
				b.[END_DSTB_CTR_FNC_CHRG_AM_LY_HLDY],
				a.[AVG_DSTB_CTR_FNC_CR_AM_LY_HLDY],
				b.[END_DSTB_CTR_FNC_CR_AM_LY_HLDY],
				a.[AVG_DSTB_CTR_STG_CHRG_AM_LY_HLDY],
				b.[END_DSTB_CTR_STG_CHRG_AM_LY_HLDY],
				a.[AVG_EST_DLVY_CST_AM_LY_HLDY],
				b.[END_EST_DLVY_CST_AM_LY_HLDY],
				a.[AVG_TRNSF_QT_LY_HLDY],
				b.[END_TRNSF_QT_LY_HLDY],
				a.[AVG_WK_OUT_OF_STK_QT_LY_HLDY],
				b.[END_WK_OUT_OF_STK_QT_LY_HLDY],
				a.[AVG_WK_OUT_OF_STK_SBS_QT_LY_HLDY],
				b.[END_WK_OUT_OF_STK_SBS_QT_LY_HLDY],
				a.[AVG_WK_OVRD_SBS_QT_LY_HLDY],
				b.[END_WK_OVRD_SBS_QT_LY_HLDY],
				a.[AVG_WK_ADJ_QT_LY_HLDY],
				b.[END_WK_ADJ_QT_LY_HLDY],
				a.[AVG_WK_DSTB_CTR_MVMT_QT_LY_HLDY],
				b.[END_WK_DSTB_CTR_MVMT_QT_LY_HLDY],
				a.[AVG_WK_MVMT_CST_AM_LY_HLDY],
				b.[END_WK_MVMT_CST_AM_LY_HLDY],
				a.[AVG_WK_MVMT_RTL_AM_LY_HLDY],
				b.[END_WK_MVMT_RTL_AM_LY_HLDY],
				a.[AVG_WK_RCV_QT_LY_HLDY],
				b.[END_WK_RCV_QT_LY_HLDY],
				a.[AVG_DSTB_CTR_BAL_ON_HND_QT_LY_HLDY],
				b.[END_DSTB_CTR_BAL_ON_HND_QT_LY_HLDY],
				a.[AVG_RTL_SVC_CTR_BAL_ON_HND_QT_LY_HLDY],
				b.[END_RTL_SVC_CTR_BAL_ON_HND_QT_LY_HLDY],
				a.[AVG_DSTB_CTR_CST_AM_LY_HLDY],
				b.[END_DSTB_CTR_CST_AM_LY_HLDY],
				a.[AVG_DSTB_CTR_FNC_CHRG_AM_LY_CAL],
				b.[END_DSTB_CTR_FNC_CHRG_AM_LY_CAL],
				a.[AVG_DSTB_CTR_FNC_CR_AM_LY_CAL],
				b.[END_DSTB_CTR_FNC_CR_AM_LY_CAL],
				a.[AVG_DSTB_CTR_STG_CHRG_AM_LY_CAL],
				b.[END_DSTB_CTR_STG_CHRG_AM_LY_CAL],
				a.[AVG_EST_DLVY_CST_AM_LY_CAL],
				b.[END_EST_DLVY_CST_AM_LY_CAL],
				a.[AVG_TRNSF_QT_LY_CAL],
				b.[END_TRNSF_QT_LY_CAL],
				a.[AVG_WK_OUT_OF_STK_QT_LY_CAL],
				b.[END_WK_OUT_OF_STK_QT_LY_CAL],
				a.[AVG_WK_OUT_OF_STK_SBS_QT_LY_CAL],
				b.[END_WK_OUT_OF_STK_SBS_QT_LY_CAL],
				a.[AVG_WK_OVRD_SBS_QT_LY_CAL],
				b.[END_WK_OVRD_SBS_QT_LY_CAL],
				a.[AVG_WK_ADJ_QT_LY_CAL],
				b.[END_WK_ADJ_QT_LY_CAL],
				a.[AVG_WK_DSTB_CTR_MVMT_QT_LY_CAL],
				b.[END_WK_DSTB_CTR_MVMT_QT_LY_CAL],
				a.[AVG_WK_MVMT_CST_AM_LY_CAL],
				b.[END_WK_MVMT_CST_AM_LY_CAL],
				a.[AVG_WK_MVMT_RTL_AM_LY_CAL],
				b.[END_WK_MVMT_RTL_AM_LY_CAL],
				a.[AVG_WK_RCV_QT_LY_CAL],
				b.[END_WK_RCV_QT_LY_CAL],
				a.[AVG_DSTB_CTR_BAL_ON_HND_QT_LY_CAL],
				b.[END_DSTB_CTR_BAL_ON_HND_QT_LY_CAL],
				a.[AVG_RTL_SVC_CTR_BAL_ON_HND_QT_LY_CAL],
				b.[END_RTL_SVC_CTR_BAL_ON_HND_QT_LY_CAL],
				a.[AVG_DSTB_CTR_CST_AM_LY_CAL],
				b.[END_DSTB_CTR_CST_AM_LY_CAL]

		    from CTE1 as a left join
            CTE2 as b on a.STR_ID =  b.STR_ID
				     AND a.P_ID = b.P_ID
				     AND a.PRE_DEF_ID = b.PRE_DEF_ID
			)

	    --select * from MERGE_TABLES

		-- INSERT INTO FCT_DSTB_CTR_INV_QTY_TY_LY_FSC TABLE
			INSERT INTO EDAA_PRES.FCT_DSTB_CTR_INV_QTY_TY_LY_FSC_AGG
		        (
				    [ROW_ID_VAL],
	                [PRE_DEF_ID],
	                [DT_VAL],
	                [STR_ID],
	                [P_ID],
					[AVG_DSTB_CTR_FNC_CHRG_AM_TY_FSC],
					[END_DSTB_CTR_FNC_CHRG_AM_TY_FSC],
					[AVG_DSTB_CTR_FNC_CHRG_AM_LY_FSC],
					[END_DSTB_CTR_FNC_CHRG_AM_LY_FSC],
					[AVG_DSTB_CTR_FNC_CR_AM_TY_FSC],
					[END_DSTB_CTR_FNC_CR_AM_TY_FSC],
					[AVG_DSTB_CTR_FNC_CR_AM_LY_FSC],
					[END_DSTB_CTR_FNC_CR_AM_LY_FSC],
					[AVG_DSTB_CTR_STG_CHRG_AM_TY_FSC],
					[END_DSTB_CTR_STG_CHRG_AM_TY_FSC],
					[AVG_DSTB_CTR_STG_CHRG_AM_LY_FSC],
					[END_DSTB_CTR_STG_CHRG_AM_LY_FSC],
					[AVG_EST_DLVY_CST_AM_TY_FSC],
					[END_EST_DLVY_CST_AM_TY_FSC],
					[AVG_EST_DLVY_CST_AM_LY_FSC],
					[END_EST_DLVY_CST_AM_LY_FSC],
					[AVG_TRNSF_QT_TY_FSC],
					[END_TRNSF_QT_TY_FSC],
					[AVG_TRNSF_QT_LY_FSC],
					[END_TRNSF_QT_LY_FSC],
					[AVG_WK_OUT_OF_STK_QT_TY_FSC],
					[END_WK_OUT_OF_STK_QT_TY_FSC],
					[AVG_WK_OUT_OF_STK_QT_LY_FSC],
					[END_WK_OUT_OF_STK_QT_LY_FSC],
					[AVG_WK_OUT_OF_STK_SBS_QT_TY_FSC],
					[END_WK_OUT_OF_STK_SBS_QT_TY_FSC],
					[AVG_WK_OUT_OF_STK_SBS_QT_LY_FSC],
					[END_WK_OUT_OF_STK_SBS_QT_LY_FSC],
					[AVG_WK_OVRD_SBS_QT_TY_FSC],
					[END_WK_OVRD_SBS_QT_TY_FSC],
					[AVG_WK_OVRD_SBS_QT_LY_FSC],
					[END_WK_OVRD_SBS_QT_LY_FSC],
					[AVG_WK_ADJ_QT_TY_FSC],
					[END_WK_ADJ_QT_TY_FSC],
					[AVG_WK_ADJ_QT_LY_FSC],
					[END_WK_ADJ_QT_LY_FSC],
					[AVG_WK_DSTB_CTR_MVMT_QT_TY_FSC],
					[END_WK_DSTB_CTR_MVMT_QT_TY_FSC],
					[AVG_WK_DSTB_CTR_MVMT_QT_LY_FSC],
					[END_WK_DSTB_CTR_MVMT_QT_LY_FSC],
					[AVG_WK_MVMT_CST_AM_TY_FSC],
					[END_WK_MVMT_CST_AM_TY_FSC],
					[AVG_WK_MVMT_CST_AM_LY_FSC],
					[END_WK_MVMT_CST_AM_LY_FSC],
					[AVG_WK_MVMT_RTL_AM_TY_FSC],
					[END_WK_MVMT_RTL_AM_TY_FSC],
					[AVG_WK_MVMT_RTL_AM_LY_FSC],
					[END_WK_MVMT_RTL_AM_LY_FSC],
					[AVG_WK_RCV_QT_TY_FSC],
					[END_WK_RCV_QT_TY_FSC],
					[AVG_WK_RCV_QT_LY_FSC],
					[END_WK_RCV_QT_LY_FSC],
					[AVG_DSTB_CTR_BAL_ON_HND_QT_TY_FSC],
					[END_DSTB_CTR_BAL_ON_HND_QT_TY_FSC],
					[AVG_DSTB_CTR_BAL_ON_HND_QT_LY_FSC],
					[END_DSTB_CTR_BAL_ON_HND_QT_LY_FSC],
					[AVG_RTL_SVC_CTR_BAL_ON_HND_QT_TY_FSC],
					[END_RTL_SVC_CTR_BAL_ON_HND_QT_TY_FSC],
					[AVG_RTL_SVC_CTR_BAL_ON_HND_QT_LY_FSC],
					[END_RTL_SVC_CTR_BAL_ON_HND_QT_LY_FSC],
					[AVG_DSTB_CTR_CST_AM_TY_FSC],
					[END_DSTB_CTR_CST_AM_TY_FSC],
					[AVG_DSTB_CTR_CST_AM_LY_FSC],
					[END_DSTB_CTR_CST_AM_LY_FSC],
					[AVG_DSTB_CTR_FNC_CHRG_AM_LY_HLDY],
					[END_DSTB_CTR_FNC_CHRG_AM_LY_HLDY],
					[AVG_DSTB_CTR_FNC_CR_AM_LY_HLDY],
					[END_DSTB_CTR_FNC_CR_AM_LY_HLDY],
					[AVG_DSTB_CTR_STG_CHRG_AM_LY_HLDY],
					[END_DSTB_CTR_STG_CHRG_AM_LY_HLDY],
					[AVG_EST_DLVY_CST_AM_LY_HLDY],
					[END_EST_DLVY_CST_AM_LY_HLDY],
					[AVG_TRNSF_QT_LY_HLDY],
					[END_TRNSF_QT_LY_HLDY],
					[AVG_WK_OUT_OF_STK_QT_LY_HLDY],
					[END_WK_OUT_OF_STK_QT_LY_HLDY],
					[AVG_WK_OUT_OF_STK_SBS_QT_LY_HLDY],
					[END_WK_OUT_OF_STK_SBS_QT_LY_HLDY],
					[AVG_WK_OVRD_SBS_QT_LY_HLDY],
					[END_WK_OVRD_SBS_QT_LY_HLDY],
					[AVG_WK_ADJ_QT_LY_HLDY],
					[END_WK_ADJ_QT_LY_HLDY],
					[AVG_WK_DSTB_CTR_MVMT_QT_LY_HLDY],
					[END_WK_DSTB_CTR_MVMT_QT_LY_HLDY],
					[AVG_WK_MVMT_CST_AM_LY_HLDY],
					[END_WK_MVMT_CST_AM_LY_HLDY],
					[AVG_WK_MVMT_RTL_AM_LY_HLDY],
					[END_WK_MVMT_RTL_AM_LY_HLDY],
					[AVG_WK_RCV_QT_LY_HLDY],
					[END_WK_RCV_QT_LY_HLDY],
					[AVG_DSTB_CTR_BAL_ON_HND_QT_LY_HLDY],
					[END_DSTB_CTR_BAL_ON_HND_QT_LY_HLDY],
					[AVG_RTL_SVC_CTR_BAL_ON_HND_QT_LY_HLDY],
					[END_RTL_SVC_CTR_BAL_ON_HND_QT_LY_HLDY],
					[AVG_DSTB_CTR_CST_AM_LY_HLDY],
					[END_DSTB_CTR_CST_AM_LY_HLDY],
					[AVG_DSTB_CTR_FNC_CHRG_AM_LY_CAL],
					[END_DSTB_CTR_FNC_CHRG_AM_LY_CAL],
					[AVG_DSTB_CTR_FNC_CR_AM_LY_CAL],
					[END_DSTB_CTR_FNC_CR_AM_LY_CAL],
					[AVG_DSTB_CTR_STG_CHRG_AM_LY_CAL],
					[END_DSTB_CTR_STG_CHRG_AM_LY_CAL],
					[AVG_EST_DLVY_CST_AM_LY_CAL],
					[END_EST_DLVY_CST_AM_LY_CAL],
					[AVG_TRNSF_QT_LY_CAL],
					[END_TRNSF_QT_LY_CAL],
					[AVG_WK_OUT_OF_STK_QT_LY_CAL],
					[END_WK_OUT_OF_STK_QT_LY_CAL],
					[AVG_WK_OUT_OF_STK_SBS_QT_LY_CAL],
					[END_WK_OUT_OF_STK_SBS_QT_LY_CAL],
					[AVG_WK_OVRD_SBS_QT_LY_CAL],
					[END_WK_OVRD_SBS_QT_LY_CAL],
					[AVG_WK_ADJ_QT_LY_CAL],
					[END_WK_ADJ_QT_LY_CAL],
					[AVG_WK_DSTB_CTR_MVMT_QT_LY_CAL],
					[END_WK_DSTB_CTR_MVMT_QT_LY_CAL],
					[AVG_WK_MVMT_CST_AM_LY_CAL],
					[END_WK_MVMT_CST_AM_LY_CAL],
					[AVG_WK_MVMT_RTL_AM_LY_CAL],
					[END_WK_MVMT_RTL_AM_LY_CAL],
					[AVG_WK_RCV_QT_LY_CAL],
					[END_WK_RCV_QT_LY_CAL],
					[AVG_DSTB_CTR_BAL_ON_HND_QT_LY_CAL],
					[END_DSTB_CTR_BAL_ON_HND_QT_LY_CAL],
					[AVG_RTL_SVC_CTR_BAL_ON_HND_QT_LY_CAL],
					[END_RTL_SVC_CTR_BAL_ON_HND_QT_LY_CAL],
					[AVG_DSTB_CTR_CST_AM_LY_CAL],
					[END_DSTB_CTR_CST_AM_LY_CAL],
				    [UPDATEDTIMESTAMP]
          )
			SELECT
			      dtsel.ROW_ID_VAL,
                  dtsel.PRE_DEF_ID,
                  CONVERT(date, CONVERT(varchar(10), dtsel.MAX_DT, 120)) AS DT_VAL,
				  A.[STR_ID],
	              A.[P_ID],
				  A.[AVG_DSTB_CTR_FNC_CHRG_AM_TY_FSC],
				  A.[END_DSTB_CTR_FNC_CHRG_AM_TY_FSC],
				  A.[AVG_DSTB_CTR_FNC_CHRG_AM_LY_FSC],
				  A.[END_DSTB_CTR_FNC_CHRG_AM_LY_FSC],
				  A.[AVG_DSTB_CTR_FNC_CR_AM_TY_FSC],
				  A.[END_DSTB_CTR_FNC_CR_AM_TY_FSC],
				  A.[AVG_DSTB_CTR_FNC_CR_AM_LY_FSC],
				  A.[END_DSTB_CTR_FNC_CR_AM_LY_FSC],
				  A.[AVG_DSTB_CTR_STG_CHRG_AM_TY_FSC],
				  A.[END_DSTB_CTR_STG_CHRG_AM_TY_FSC],
				  A.[AVG_DSTB_CTR_STG_CHRG_AM_LY_FSC],
				  A.[END_DSTB_CTR_STG_CHRG_AM_LY_FSC],
				  A.[AVG_EST_DLVY_CST_AM_TY_FSC],
				  A.[END_EST_DLVY_CST_AM_TY_FSC],
				  A.[AVG_EST_DLVY_CST_AM_LY_FSC],
				  A.[END_EST_DLVY_CST_AM_LY_FSC],
				  A.[AVG_TRNSF_QT_TY_FSC],
				  A.[END_TRNSF_QT_TY_FSC],
				  A.[AVG_TRNSF_QT_LY_FSC],
				  A.[END_TRNSF_QT_LY_FSC],
				  A.[AVG_WK_OUT_OF_STK_QT_TY_FSC],
				  A.[END_WK_OUT_OF_STK_QT_TY_FSC],
				  A.[AVG_WK_OUT_OF_STK_QT_LY_FSC],
				  A.[END_WK_OUT_OF_STK_QT_LY_FSC],
				  A.[AVG_WK_OUT_OF_STK_SBS_QT_TY_FSC],
				  A.[END_WK_OUT_OF_STK_SBS_QT_TY_FSC],
				  A.[AVG_WK_OUT_OF_STK_SBS_QT_LY_FSC],
				  A.[END_WK_OUT_OF_STK_SBS_QT_LY_FSC],
				  A.[AVG_WK_OVRD_SBS_QT_TY_FSC],
				  A.[END_WK_OVRD_SBS_QT_TY_FSC],
				  A.[AVG_WK_OVRD_SBS_QT_LY_FSC],
				  A.[END_WK_OVRD_SBS_QT_LY_FSC],
				  A.[AVG_WK_ADJ_QT_TY_FSC],
				  A.[END_WK_ADJ_QT_TY_FSC],
				  A.[AVG_WK_ADJ_QT_LY_FSC],
				  A.[END_WK_ADJ_QT_LY_FSC],
				  A.[AVG_WK_DSTB_CTR_MVMT_QT_TY_FSC],
				  A.[END_WK_DSTB_CTR_MVMT_QT_TY_FSC],
				  A.[AVG_WK_DSTB_CTR_MVMT_QT_LY_FSC],
				  A.[END_WK_DSTB_CTR_MVMT_QT_LY_FSC],
				  A.[AVG_WK_MVMT_CST_AM_TY_FSC],
				  A.[END_WK_MVMT_CST_AM_TY_FSC],
				  A.[AVG_WK_MVMT_CST_AM_LY_FSC],
				  A.[END_WK_MVMT_CST_AM_LY_FSC],
				  A.[AVG_WK_MVMT_RTL_AM_TY_FSC],
				  A.[END_WK_MVMT_RTL_AM_TY_FSC],
				  A.[AVG_WK_MVMT_RTL_AM_LY_FSC],
				  A.[END_WK_MVMT_RTL_AM_LY_FSC],
				  A.[AVG_WK_RCV_QT_TY_FSC],
				  A.[END_WK_RCV_QT_TY_FSC],
				  A.[AVG_WK_RCV_QT_LY_FSC],
				  A.[END_WK_RCV_QT_LY_FSC],
				  A.[AVG_DSTB_CTR_BAL_ON_HND_QT_TY_FSC],
				  A.[END_DSTB_CTR_BAL_ON_HND_QT_TY_FSC],
				  A.[AVG_DSTB_CTR_BAL_ON_HND_QT_LY_FSC],
				  A.[END_DSTB_CTR_BAL_ON_HND_QT_LY_FSC],
				  A.[AVG_RTL_SVC_CTR_BAL_ON_HND_QT_TY_FSC],
				  A.[END_RTL_SVC_CTR_BAL_ON_HND_QT_TY_FSC],
				  A.[AVG_RTL_SVC_CTR_BAL_ON_HND_QT_LY_FSC],
				  A.[END_RTL_SVC_CTR_BAL_ON_HND_QT_LY_FSC],
				  A.[AVG_DSTB_CTR_CST_AM_TY_FSC],
				  A.[END_DSTB_CTR_CST_AM_TY_FSC],
				  A.[AVG_DSTB_CTR_CST_AM_LY_FSC],
				  A.[END_DSTB_CTR_CST_AM_LY_FSC],
				  A.[AVG_DSTB_CTR_FNC_CHRG_AM_LY_HLDY],
				  A.[END_DSTB_CTR_FNC_CHRG_AM_LY_HLDY],
				  A.[AVG_DSTB_CTR_FNC_CR_AM_LY_HLDY],
				  A.[END_DSTB_CTR_FNC_CR_AM_LY_HLDY],
				  A.[AVG_DSTB_CTR_STG_CHRG_AM_LY_HLDY],
				  A.[END_DSTB_CTR_STG_CHRG_AM_LY_HLDY],
				  A.[AVG_EST_DLVY_CST_AM_LY_HLDY],
				  A.[END_EST_DLVY_CST_AM_LY_HLDY],
				  A.[AVG_TRNSF_QT_LY_HLDY],
				  A.[END_TRNSF_QT_LY_HLDY],
				  A.[AVG_WK_OUT_OF_STK_QT_LY_HLDY],
				  A.[END_WK_OUT_OF_STK_QT_LY_HLDY],
				  A.[AVG_WK_OUT_OF_STK_SBS_QT_LY_HLDY],
				  A.[END_WK_OUT_OF_STK_SBS_QT_LY_HLDY],
				  A.[AVG_WK_OVRD_SBS_QT_LY_HLDY],
				  A.[END_WK_OVRD_SBS_QT_LY_HLDY],
				  A.[AVG_WK_ADJ_QT_LY_HLDY],
				  A.[END_WK_ADJ_QT_LY_HLDY],
				  A.[AVG_WK_DSTB_CTR_MVMT_QT_LY_HLDY],
				  A.[END_WK_DSTB_CTR_MVMT_QT_LY_HLDY],
				  A.[AVG_WK_MVMT_CST_AM_LY_HLDY],
				  A.[END_WK_MVMT_CST_AM_LY_HLDY],
				  A.[AVG_WK_MVMT_RTL_AM_LY_HLDY],
				  A.[END_WK_MVMT_RTL_AM_LY_HLDY],
				  A.[AVG_WK_RCV_QT_LY_HLDY],
				  A.[END_WK_RCV_QT_LY_HLDY],
				  A.[AVG_DSTB_CTR_BAL_ON_HND_QT_LY_HLDY],
				  A.[END_DSTB_CTR_BAL_ON_HND_QT_LY_HLDY],
				  A.[AVG_RTL_SVC_CTR_BAL_ON_HND_QT_LY_HLDY],
				  A.[END_RTL_SVC_CTR_BAL_ON_HND_QT_LY_HLDY],
				  A.[AVG_DSTB_CTR_CST_AM_LY_HLDY],
				  A.[END_DSTB_CTR_CST_AM_LY_HLDY],
				  A.[AVG_DSTB_CTR_FNC_CHRG_AM_LY_CAL],
				  A.[END_DSTB_CTR_FNC_CHRG_AM_LY_CAL],
				  A.[AVG_DSTB_CTR_FNC_CR_AM_LY_CAL],
				  A.[END_DSTB_CTR_FNC_CR_AM_LY_CAL],
				  A.[AVG_DSTB_CTR_STG_CHRG_AM_LY_CAL],
				  A.[END_DSTB_CTR_STG_CHRG_AM_LY_CAL],
				  A.[AVG_EST_DLVY_CST_AM_LY_CAL],
				  A.[END_EST_DLVY_CST_AM_LY_CAL],
				  A.[AVG_TRNSF_QT_LY_CAL],
				  A.[END_TRNSF_QT_LY_CAL],
				  A.[AVG_WK_OUT_OF_STK_QT_LY_CAL],
				  A.[END_WK_OUT_OF_STK_QT_LY_CAL],
				  A.[AVG_WK_OUT_OF_STK_SBS_QT_LY_CAL],
				  A.[END_WK_OUT_OF_STK_SBS_QT_LY_CAL],
				  A.[AVG_WK_OVRD_SBS_QT_LY_CAL],
				  A.[END_WK_OVRD_SBS_QT_LY_CAL],
				  A.[AVG_WK_ADJ_QT_LY_CAL],
				  A.[END_WK_ADJ_QT_LY_CAL],
				  A.[AVG_WK_DSTB_CTR_MVMT_QT_LY_CAL],
				  A.[END_WK_DSTB_CTR_MVMT_QT_LY_CAL],
				  A.[AVG_WK_MVMT_CST_AM_LY_CAL],
				  A.[END_WK_MVMT_CST_AM_LY_CAL],
				  A.[AVG_WK_MVMT_RTL_AM_LY_CAL],
				  A.[END_WK_MVMT_RTL_AM_LY_CAL],
				  A.[AVG_WK_RCV_QT_LY_CAL],
				  A.[END_WK_RCV_QT_LY_CAL],
				  A.[AVG_DSTB_CTR_BAL_ON_HND_QT_LY_CAL],
				  A.[END_DSTB_CTR_BAL_ON_HND_QT_LY_CAL],
				  A.[AVG_RTL_SVC_CTR_BAL_ON_HND_QT_LY_CAL],
				  A.[END_RTL_SVC_CTR_BAL_ON_HND_QT_LY_CAL],
				  A.[AVG_DSTB_CTR_CST_AM_LY_CAL],
				  A.[END_DSTB_CTR_CST_AM_LY_CAL],
				  GETDATE() as [UPDATEDTIMESTAMP]

			FROM MERGE_TABLES as A inner join
			(SELECT
           *,
           ROW_NUMBER() OVER (ORDER BY PRE_DEF_ID) AS ROW_ID_VAL
         FROM EDAA_PRES.V_DIM_PRE_DEF_CAL_TYP
		 WHERE AGG_TYP ='AGG'
         ) as dtsel
		 ON A.PRE_DEF_ID = dtsel.PRE_DEF_ID


	    --UPDATE STATISTICS
		UPDATE STATISTICS [EDAA_PRES].[FCT_DSTB_CTR_INV_QTY_TY_LY_FSC_AGG];

	  END TRY

	   BEGIN CATCH
		EXEC EDAA_CNTL.SP_AUDIT_DATA_LOAD_END @AUD_SKY = @NEW_AUD_SKY,
											  @NBR_OF_RW_ISRT = 0,
											  @NBR_OF_RW_UDT = 0
		SET @ERROR_PROCEDURE_NAME = 'EDAA_ETL.PROC_FCT_DLY_ITM_SKU_STR_DF_INV_QTY_AGG_LOAD'
		--SET @ERROR_LINE
		--SET @ERROR_MSG

		SELECT
		  @ERROR_LINE = ERROR_NUMBER(),
		  @ERROR_MSG = ERROR_MESSAGE();

		--------- Log execution error ----------
		EXEC EDAA_CNTL.SP_LOG_AUD_ERR @AUD_SKY = @NEW_AUD_SKY,
									  @ERROR_PROCEDURE_NAME = @ERROR_PROCEDURE_NAME,
									  @ERROR_LINE = @ERROR_LINE,
									  @ERROR_MSG = @ERROR_MSG;

		THROW;

	  END CATCH

  END
